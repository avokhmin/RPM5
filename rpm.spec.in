%define	with_python_subpackage	@WITH_PYTHON_SUBPACKAGE@%{nil}
%define	with_python_version	@WITH_PYTHON_VERSION@%{nil}
%define	with_perl_subpackage	@WITH_PERL_SUBPACKAGE@%{nil}
%define	with_bzip2		@WITH_BZIP2@%{nil}
%define	with_apidocs		@WITH_APIDOCS@%{nil}

# Autogenerate shell script dependencies.
#%%define __executable_requires	@RPMCONFIGDIR@/executabledeps.sh --requires

# XXX legacy requires './' payload prefix to be omitted from rpm packages.
%define	_noPayloadPrefix	1

%define	__prefix	%{?_prefix}%{!?_prefix:/usr}
%{?!_lib: %define _lib lib}
%{expand: %%define __share %(if [ -d %{__prefix}/share/man ]; then echo /share ; else echo %%{nil} ; fi)}

%define __bindir	%{__prefix}/bin
%define __includedir	%{__prefix}/include
%define __libdir	%{__prefix}/%{_lib}
%define __mandir	%{__prefix}%{__share}/man

Summary: The RPM package management system.
Name: rpm
%define version @VERSION@
Version: %{version}
%{expand: %%define rpm_version %{version}}
Release: 0.40
Group: System Environment/Base
Source: ftp://wraptastic.org/pub/rpm-devel/rpm-%{rpm_version}.tar.gz
License: GPL
Conflicts: patch < 2.5
%ifos linux
Prereq: fileutils shadow-utils
%endif
BuildRequires(hint): %%{rpm_license_check}
Requires(hint): %%{rpm_license_check}
Requires: getconf(GNU_LIBPTHREAD_VERSION) = NPTL
Requires: popt = 1.10.3
Obsoletes: rpm-perl < %{version}

# XXX necessary only to drag in /usr/lib/libelf.a, otherwise internal elfutils.
BuildRequires: elfutils-libelf
BuildRequires: elfutils-devel

BuildRequires: zlib-devel

BuildRequires: beecrypt-devel >= 4.1.2
Requires: beecrypt >= 4.1.2

BuildRequires: neon-devel
BuildRequires: sqlite-devel

# XXX Red Hat 5.2 has not bzip2 or python
%if %{with_bzip2}
BuildRequires: bzip2-devel >= 0.9.0c-2
%endif
%if %{with_python_subpackage}
BuildRequires: python-devel >= %{with_python_version}
%endif
%if %{with_perl_subpackage}
BuildRequires: perl >= 2:5.8.0
%endif

BuildRoot: %{_tmppath}/%{name}-root

%description
The RPM Package Manager (RPM) is a powerful command line driven
package management system capable of installing, uninstalling,
verifying, querying, and updating software packages. Each software
package consists of an archive of files along with information about
the package like its version, a description, etc.

%package libs
Summary:  Libraries for manipulating RPM packages.
Group: Development/Libraries
Requires(hint): %%{rpm_license_check}
Requires: getconf(GNU_LIBPTHREAD_VERSION) = NPTL

%description libs
This package contains the RPM shared libraries.

%package devel
Summary:  Development files for manipulating RPM packages.
Group: Development/Libraries
Requires: rpm = %{rpm_version}-%{release}
Requires: rpm-libs = %{rpm_version}-%{release}
Requires: beecrypt >= 4.1.2
Requires: neon-devel
Requires: sqlite-devel
Requires(hint): %%{rpm_license_check}
Requires: getconf(GNU_LIBPTHREAD_VERSION) = NPTL

%description devel
This package contains the RPM C library and header files. These
development files will simplify the process of writing programs that
manipulate RPM packages and databases. These files are intended to
simplify the process of creating graphical package managers or any
other tools that need an intimate knowledge of RPM packages in order
to function.

This package should be installed if you want to develop programs that
will manipulate RPM packages and databases.

%package build
Summary: Scripts and executable programs used to build packages.
Group: Development/Tools
Requires: rpm = %{rpm_version}-%{release}, patch >= 2.5, file
Provides: rpmbuild(VendorConfig) = 4.1-1
Requires(hint): %%{rpm_license_check}
Requires: getconf(GNU_LIBPTHREAD_VERSION) = NPTL

%description build
The rpm-build package contains the scripts and executable programs
that are used to build packages using the RPM Package Manager.

%if %{with_python_subpackage}
%package python
Summary: Python bindings for apps which will manipulate RPM packages.
Group: Development/Libraries
Requires: rpm = %{rpm_version}-%{release}
Requires: rpm-libs = %{rpm_version}-%{release}
Requires: python >= %{with_python_version}
Requires: elfutils >= 0.55
Requires(hint): %%{rpm_license_check}

%description python
The rpm-python package contains a module that permits applications
written in the Python programming language to use the interface
supplied by RPM Package Manager libraries.

This package should be installed if you want to develop Python
programs that will manipulate RPM packages and databases.
%endif

%if %{with_perl_subpackage}
%package perl
Summary: Perl bindings for apps which will manipulate RPM packages.
Group: Development/Libraries
Requires: rpm = %{rpm_version}-%{release}
Requires: rpm-libs = %{rpm_version}-%{release}
Requires(hint): %%{rpm_license_check}
Obsoletes: perl-RPM2
Conflicts: perl-RPM2

%description perl
The rpm-perl package contains a module that permits applications
written in the Perl programming language to use the interface
supplied by RPM Package Manager libraries.

This package should be installed if you want to develop Perl
programs that will manipulate RPM packages and databases.

(Note: rpm-perl perl-RPM2-0.66, and will obsolete existing perl-RPM2 packages)
%endif

%package -n popt
Summary: A C library for parsing command line parameters.
Group: Development/Libraries
Version: 1.10.3
Requires(hint): %%{rpm_license_check}

%description -n popt
Popt is a C library for parsing command line parameters. Popt was
heavily influenced by the getopt() and getopt_long() functions, but it
improves on them by allowing more powerful argument expansion. Popt
can parse arbitrary argv[] style arrays and automatically set
variables based on command line arguments. Popt allows command line
arguments to be aliased via configuration files and includes utility
functions for parsing arbitrary strings into argv[] arrays using
shell-like rules.

%prep
%setup -q

%build

# XXX rpm needs functioning nptl for configure tests
unset LD_ASSUME_KERNEL || :

%if %{with_python_subpackage}
WITH_PYTHON="--with-python=%{with_python_version}"
%else
WITH_PYTHON="--without-python"
%endif

%if %{with_perl_subpackage}
WITH_PYTHON="--with-perl"
%else
WITH_PYTHON="--without-perl"
%endif

%ifos linux
CFLAGS="$RPM_OPT_FLAGS"; export CFLAGS
./configure --prefix=%{__prefix} --sysconfdir=/etc \
	--localstatedir=/var --infodir='${prefix}%{__share}/info' \
	--mandir='${prefix}%{__share}/man' \
	$WITH_PYTHON $WITH_PERL --enable-posixmutexes --without-javaglue
%else
export CPPFLAGS=-I%{__prefix}/include 
CFLAGS="$RPM_OPT_FLAGS" ./configure --prefix=%{__prefix} $WITH_PYTHON $WITH_PERL \
	--without-javaglue
%endif

make %{?_smp_mflags}

%install
# XXX rpm needs functioning nptl for configure tests
unset LD_ASSUME_KERNEL || :

rm -rf $RPM_BUILD_ROOT

make DESTDIR="$RPM_BUILD_ROOT" install

%ifos linux

# Save list of packages through cron
mkdir -p ${RPM_BUILD_ROOT}/etc/cron.daily
install -m 755 scripts/rpm.daily ${RPM_BUILD_ROOT}/etc/cron.daily/rpm

mkdir -p ${RPM_BUILD_ROOT}/etc/logrotate.d
install -m 644 scripts/rpm.log ${RPM_BUILD_ROOT}/etc/logrotate.d/rpm

mkdir -p $RPM_BUILD_ROOT/etc/rpm

mkdir -p $RPM_BUILD_ROOT/var/spool/repackage
mkdir -p $RPM_BUILD_ROOT/var/lib/rpm
for dbi in \
	Basenames Conflictname Dirnames Group Installtid Name Packages \
	Providename Provideversion Requirename Requireversion Triggername \
	Filemd5s Pubkeys Sha1header Sigmd5 \
	__db.001 __db.002 __db.003 __db.004 __db.005 __db.006 __db.007 \
	__db.008 __db.009
do
    touch $RPM_BUILD_ROOT/var/lib/rpm/$dbi
done

%endif

%if %{with_apidocs}
gzip -9n apidocs/man/man*/* || :
%endif

# Get rid of unpackaged files
{ cd $RPM_BUILD_ROOT
  rm -f .%{__prefix}/lib/rpm/{Specfile.pm,cpanflute,cpanflute2,rpmdiff,rpmdiff.cgi,sql.prov,sql.req,tcl.req}
  rm -rf .%{__mandir}/{fr,ko}
  rm -f .%{__bindir}/rpm{e,i,u}
  rm -f .%{__libdir}/rpm{popt,rc}
%if %{with_python_subpackage}
  rm -f .%{__libdir}/python%{with_python_version}/site-packages/*.{a,la}
  rm -f .%{__libdir}/python%{with_python_version}/site-packages/rpm/*.{a,la}
%endif
%if %{with_perl_subpackage}
  find .%{__libdir}/perl5 -type f -a \( -name perllocal.pod -o -name .packlist \
    -o \( -name '*.bs' -a -empty \) \) -exec rm -f {} ';'
  find .%{__libdir}/perl5 -type d -depth -exec rmdir {} 2>/dev/null ';'
%endif
}

%clean
rm -rf $RPM_BUILD_ROOT

%ifos linux
%pre
/usr/sbin/groupadd -g 37 @RPMGROUP@				> /dev/null 2>&1
/usr/sbin/useradd  -r -d /var/lib/rpm -u 37 -g 37 @RPMUSER@ -s /sbin/nologin	> /dev/null 2>&1
exit 0
%endif

%post
%ifos linux
/sbin/ldconfig

# Establish correct rpmdb ownership.
/bin/chown @RPMUSER@:@RPMGROUP@ /var/lib/rpm/[A-Z]*

# XXX Detect (and remove) incompatible dbenv files during db-4.4.11 upgrade.
# XXX Removing dbenv files in %%post opens a lock race window, a tolerable
# XXX risk compared to the support issues involved with upgrading Berkeley DB.
[ -w /var/lib/rpm/__db.001 ] &&
/usr/lib/rpm/rpmdb_stat -CA -h /var/lib/rpm 2>&1 |
grep "db_stat: Program version 4.4 doesn't match environment version" 2>&1 > /dev/null &&
	rm -f /var/lib/rpm/__db*
                                                                                
%endif
exit 0

%ifos linux
%postun
/sbin/ldconfig
if [ $1 = 0 ]; then
    /usr/sbin/userdel @RPMUSER@
    /usr/sbin/groupdel @RPMGROUP@
fi
exit 0

%post devel -p /sbin/ldconfig
%postun devel -p /sbin/ldconfig

%post -n popt -p /sbin/ldconfig
%postun -n popt -p /sbin/ldconfig
%endif

%define	rpmattr		%attr(0755, @RPMUSER@, @RPMGROUP@)

%files
%defattr(-,root,root)
%doc RPM-PGP-KEY RPM-GPG-KEY BETA-GPG-KEY CHANGES GROUPS doc/manual/[a-z]*
# XXX comment these lines out if building with rpm that knows not %pubkey attr
%pubkey RPM-PGP-KEY
%pubkey RPM-GPG-KEY
%pubkey BETA-GPG-KEY
%attr(0755, @RPMUSER@, @RPMGROUP@)	/bin/rpm

%ifos linux
%config(noreplace,missingok)	/etc/cron.daily/rpm
%config(noreplace,missingok)	/etc/logrotate.d/rpm
%dir				/etc/rpm
#%config(noreplace,missingok)	/etc/rpm/macros.*
%attr(0755, @RPMUSER@, @RPMGROUP@)	%dir /var/lib/rpm
%attr(0755, @RPMUSER@, @RPMGROUP@)	%dir /var/spool/repackage

%define	rpmdbattr %attr(0644, @RPMUSER@, @RPMGROUP@) %verify(not md5 size mtime) %ghost %config(missingok,noreplace)
%rpmdbattr	/var/lib/rpm/*
%endif

%rpmattr	%{__bindir}/rpm2cpio
%rpmattr	%{__bindir}/gendiff
%rpmattr	%{__bindir}/rpmdb
#%rpmattr	%{__bindir}/rpm[eiu]
%rpmattr	%{__bindir}/rpmsign
%rpmattr	%{__bindir}/rpmquery
%rpmattr	%{__bindir}/rpmverify

%attr(0755, @RPMUSER@, @RPMGROUP@)	%dir %{__prefix}/lib/rpm
%rpmattr	%{__prefix}/lib/rpm/config.guess
%rpmattr	%{__prefix}/lib/rpm/config.sub
%rpmattr	%{__prefix}/lib/rpm/convertrpmrc.sh
%rpmattr	%{__prefix}/lib/rpm/freshen.sh
%attr(0644, @RPMUSER@, @RPMGROUP@)	%{__prefix}/lib/rpm/macros
%rpmattr	%{__prefix}/lib/rpm/mkinstalldirs
%rpmattr	%{__prefix}/lib/rpm/rpm.*
%rpmattr	%{__prefix}/lib/rpm/rpm2cpio.sh
%rpmattr	%{__prefix}/lib/rpm/rpm[deiukqv]
%rpmattr	%{__prefix}/lib/rpm/tgpg
%attr(0644, @RPMUSER@, @RPMGROUP@)	%{__prefix}/lib/rpm/rpmpopt*
%attr(0644, @RPMUSER@, @RPMGROUP@)	%{__prefix}/lib/rpm/rpmrc

%ifarch i386 i486 i586 i686 athlon pentium3 pentium4
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/i[3456]86*
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/athlon*
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/pentium*
%endif
%ifarch alpha alphaev5 alphaev56 alphapca56 alphaev6 alphaev67
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/alpha*
%endif
%ifarch sparc sparcv8 sparcv9 sparc64
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/sparc*
%endif
%ifarch ia64
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/ia64*
%endif
%ifarch powerpc ppc ppciseries ppcpseries ppcmac ppc64
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/ppc*
%endif
%ifarch s390 s390x
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/s390*
%endif
%ifarch armv3l armv4b armv4l
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/armv[34][lb]*
%endif
%ifarch armv5teb armv5tel
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/armv[345]*
%endif
%ifarch mips mipsel
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/mips*
%endif
%ifarch x86_64
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/x86_64*
%endif
%attr(-, @RPMUSER@, @RPMGROUP@)		%{__prefix}/lib/rpm/noarch*

%rpmattr	%{__prefix}/lib/rpm/rpmdb_*
%rpmattr	%{__prefix}/lib/rpm/rpmfile

%lang(cs)	%{__prefix}/*/locale/cs/LC_MESSAGES/rpm.mo
%lang(da)	%{__prefix}/*/locale/da/LC_MESSAGES/rpm.mo
%lang(de)	%{__prefix}/*/locale/de/LC_MESSAGES/rpm.mo
%lang(fi)	%{__prefix}/*/locale/fi/LC_MESSAGES/rpm.mo
%lang(fr)	%{__prefix}/*/locale/fr/LC_MESSAGES/rpm.mo
%lang(gl)	%{__prefix}/*/locale/gl/LC_MESSAGES/rpm.mo
%lang(is)	%{__prefix}/*/locale/is/LC_MESSAGES/rpm.mo
%lang(ja)	%{__prefix}/*/locale/ja/LC_MESSAGES/rpm.mo
%lang(ko)	%{__prefix}/*/locale/ko/LC_MESSAGES/rpm.mo
%lang(no)	%{__prefix}/*/locale/no/LC_MESSAGES/rpm.mo
%lang(pl)	%{__prefix}/*/locale/pl/LC_MESSAGES/rpm.mo
%lang(pt)	%{__prefix}/*/locale/pt/LC_MESSAGES/rpm.mo
%lang(pt_BR)	%{__prefix}/*/locale/pt_BR/LC_MESSAGES/rpm.mo
%lang(ro)	%{__prefix}/*/locale/ro/LC_MESSAGES/rpm.mo
%lang(ru)	%{__prefix}/*/locale/ru/LC_MESSAGES/rpm.mo
%lang(sk)	%{__prefix}/*/locale/sk/LC_MESSAGES/rpm.mo
%lang(sl)	%{__prefix}/*/locale/sl/LC_MESSAGES/rpm.mo
%lang(sr)	%{__prefix}/*/locale/sr/LC_MESSAGES/rpm.mo
%lang(sv)	%{__prefix}/*/locale/sv/LC_MESSAGES/rpm.mo
%lang(tr)	%{__prefix}/*/locale/tr/LC_MESSAGES/rpm.mo
%lang(uk)	%{__prefix}/*/locale/uk/LC_MESSAGES/rpm.mo

%{__mandir}/man8/rpm.8*
%{__mandir}/man8/rpm2cpio.8*
%lang(ja)	%{__mandir}/ja/man8/rpm.8*
%lang(ja)	%{__mandir}/ja/man8/rpm2cpio.8*
#%lang(ko)	%{__mandir}/ko/man8/rpm.8*
#%lang(ko)	%{__mandir}/ko/man8/rpm2cpio.8*
%lang(pl)	%{__mandir}/pl/man8/rpm.8*
%lang(pl)	%{__mandir}/pl/man8/rpm2cpio.8*
%lang(ru)	%{__mandir}/ru/man8/rpm.8*
%lang(ru)	%{__mandir}/ru/man8/rpm2cpio.8*
%lang(sk)	%{__mandir}/sk/man8/rpm.8*

%files libs
%defattr(-,root,root)
%{__libdir}/librpm-4.4.so
%{__libdir}/librpmdb-4.4.so
%{__libdir}/librpmio-4.4.so
%{__libdir}/librpmbuild-4.4.so

%files build
%defattr(-,root,root)
%dir %{__prefix}/src/rpm
%dir %{__prefix}/src/rpm/BUILD
%dir %{__prefix}/src/rpm/SPECS
%dir %{__prefix}/src/rpm/SOURCES
%dir %{__prefix}/src/rpm/SRPMS
%dir %{__prefix}/src/rpm/RPMS
%{__prefix}/src/rpm/RPMS/*
%rpmattr	%{__bindir}/rpmbuild
%rpmattr	%{__prefix}/lib/rpm/brp-*
%rpmattr	%{__prefix}/lib/rpm/check-files
%rpmattr	%{__prefix}/lib/rpm/check-java-closure.sh
%rpmattr	%{__prefix}/lib/rpm/check-prereqs
%rpmattr	%{__prefix}/lib/rpm/config.site
%rpmattr	%{__prefix}/lib/rpm/cross-build
%rpmattr	%{__prefix}/lib/rpm/debugedit
%rpmattr	%{__prefix}/lib/rpm/find-debuginfo.sh
%rpmattr	%{__prefix}/lib/rpm/find-lang.sh
%rpmattr	%{__prefix}/lib/rpm/find-prov.pl
%rpmattr	%{__prefix}/lib/rpm/find-provides
%rpmattr	%{__prefix}/lib/rpm/find-provides.perl
%rpmattr	%{__prefix}/lib/rpm/find-req.pl
%rpmattr	%{__prefix}/lib/rpm/find-requires
%rpmattr	%{__prefix}/lib/rpm/find-requires.perl
%rpmattr	%{__prefix}/lib/rpm/get_magic.pl
%rpmattr	%{__prefix}/lib/rpm/getpo.sh
%rpmattr	%{__prefix}/lib/rpm/http.req
%rpmattr	%{__prefix}/lib/rpm/java.prov.sh
%rpmattr	%{__prefix}/lib/rpm/java.req.sh
%rpmattr	%{__prefix}/lib/rpm/javadeps
%rpmattr	%{__prefix}/lib/rpm/magic
%rpmattr	%{__prefix}/lib/rpm/magic.mgc
%rpmattr	%{__prefix}/lib/rpm/magic.mime
%rpmattr	%{__prefix}/lib/rpm/magic.mime.mgc
%rpmattr	%{__prefix}/lib/rpm/magic.prov
%rpmattr	%{__prefix}/lib/rpm/magic.req

%rpmattr	%{__prefix}/lib/rpm/executabledeps.sh
%rpmattr	%{__prefix}/lib/rpm/libtooldeps.sh
%rpmattr	%{__prefix}/lib/rpm/perldeps.pl
%rpmattr	%{__prefix}/lib/rpm/perl.prov
%rpmattr	%{__prefix}/lib/rpm/perl.req
%rpmattr	%{__prefix}/lib/rpm/pkgconfigdeps.sh
%rpmattr	%{__prefix}/lib/rpm/pythondeps.sh
%rpmattr	%{__prefix}/lib/rpm/rpmdeps

%rpmattr	%{__prefix}/lib/rpm/rpm[bt]
%rpmattr	%{__prefix}/lib/rpm/trpm
%rpmattr	%{__prefix}/lib/rpm/u_pkg.sh
%rpmattr	%{__prefix}/lib/rpm/vpkg-provides.sh
%rpmattr	%{__prefix}/lib/rpm/vpkg-provides2.sh

%{__mandir}/man1/gendiff.1*
%{__mandir}/man8/rpmbuild.8*
%{__mandir}/man8/rpmdeps.8*
#%lang(ja)	%{__mandir}/ja/man1/gendiff.1*
%lang(ja)	%{__mandir}/ja/man8/rpmbuild.8*
#%lang(ja)	%{__mandir}/ja/man8/rpmdeps.8*
#%lang(ko)	%{__mandir}/ko/man1/gendiff.1*
#%lang(ko)	%{__mandir}/ko/man8/rpmbuild.8*
#%lang(ko)	%{__mandir}/ko/man8/rpmdeps.8*
%lang(pl)	%{__mandir}/pl/man1/gendiff.1*
%lang(pl)	%{__mandir}/pl/man8/rpmbuild.8*
%lang(pl)	%{__mandir}/pl/man8/rpmdeps.8*
#%lang(ru)	%{__mandir}/ru/man1/gendiff.1*
#%lang(ru)	%{__mandir}/ru/man8/rpmbuild.8*
#%lang(ru)	%{__mandir}/ru/man8/rpmdeps.8*
#%lang(sk)	%{__mandir}/sk/man1/gendiff.1*
#%lang(sk)	%{__mandir}/sk/man8/rpmbuild.8*
#%lang(sk)	%{__mandir}/sk/man8/rpmdeps.8*

%if %{with_python_subpackage}
%files python
%defattr(-,root,root)
%{__libdir}/python%{with_python_version}/site-packages/rpm
%endif

%if %{with_perl_subpackage}
%files perl
%defattr(-,root,root)
%{__libdir}/perl5/site_perl/*/*/auto/RPM2
%{__libdir}/perl5/site_perl/*/*/RPM2.*
%{__mandir}/man3/RPM2.*
%endif

%files devel
%defattr(-,root,root)
%if %{with_apidocs}
%doc @WITH_APIDOCS_TARGET@
%endif
%{__includedir}/rpm
%{__libdir}/librpm.a
%{__libdir}/librpm.la
%{__libdir}/librpm.so
%{__libdir}/librpmdb.a
%{__libdir}/librpmdb.la
%{__libdir}/librpmdb.so
%{__libdir}/librpmio.a
%{__libdir}/librpmio.la
%{__libdir}/librpmio.so
%{__libdir}/librpmbuild.a
%{__libdir}/librpmbuild.la
%{__libdir}/librpmbuild.so
%rpmattr	%{__prefix}/lib/rpm/rpmcache
%rpmattr	%{__bindir}/rpmgraph

%{__mandir}/man8/rpmcache.8*
%{__mandir}/man8/rpmgraph.8*
%lang(ja)	%{__mandir}/ja/man8/rpmcache.8*
%lang(ja)	%{__mandir}/ja/man8/rpmgraph.8*
#%lang(ko)	%{__mandir}/ko/man8/rpmcache.8*
#%lang(ko)	%{__mandir}/ko/man8/rpmgraph.8*
%lang(pl)	%{__mandir}/pl/man8/rpmcache.8*
%lang(pl)	%{__mandir}/pl/man8/rpmgraph.8*
#%lang(ru)	%{__mandir}/ru/man8/rpmcache.8*
#%lang(ru)	%{__mandir}/ru/man8/rpmgraph.8*
#%lang(sk)	%{__mandir}/sk/man8/rpmcache.8*
#%lang(sk)	%{__mandir}/sk/man8/rpmgraph.8*

%files -n popt
%defattr(-,root,root)
%{__libdir}/libpopt.so.*
%{__mandir}/man3/popt.3*
%lang(cs)	%{__prefix}/*/locale/cs/LC_MESSAGES/popt.mo
%lang(da)	%{__prefix}/*/locale/da/LC_MESSAGES/popt.mo
%lang(de)	%{__prefix}/*/locale/de/LC_MESSAGES/popt.mo
%lang(es)	%{__prefix}/*/locale/es/LC_MESSAGES/popt.mo
%lang(eu_ES)	%{__prefix}/*/locale/eu_ES/LC_MESSAGES/popt.mo
%lang(fi)	%{__prefix}/*/locale/fi/LC_MESSAGES/popt.mo
%lang(fr)	%{__prefix}/*/locale/fr/LC_MESSAGES/popt.mo
%lang(gl)	%{__prefix}/*/locale/gl/LC_MESSAGES/popt.mo
%lang(hu)	%{__prefix}/*/locale/hu/LC_MESSAGES/popt.mo
%lang(id)	%{__prefix}/*/locale/id/LC_MESSAGES/popt.mo
%lang(is)	%{__prefix}/*/locale/is/LC_MESSAGES/popt.mo
%lang(it)	%{__prefix}/*/locale/it/LC_MESSAGES/popt.mo
%lang(ja)	%{__prefix}/*/locale/ja/LC_MESSAGES/popt.mo
%lang(ko)	%{__prefix}/*/locale/ko/LC_MESSAGES/popt.mo
%lang(no)	%{__prefix}/*/locale/no/LC_MESSAGES/popt.mo
%lang(pl)	%{__prefix}/*/locale/pl/LC_MESSAGES/popt.mo
%lang(pt)	%{__prefix}/*/locale/pt/LC_MESSAGES/popt.mo
%lang(pt_BR)	%{__prefix}/*/locale/pt_BR/LC_MESSAGES/popt.mo
%lang(ro)	%{__prefix}/*/locale/ro/LC_MESSAGES/popt.mo
%lang(ru)	%{__prefix}/*/locale/ru/LC_MESSAGES/popt.mo
%lang(sk)	%{__prefix}/*/locale/sk/LC_MESSAGES/popt.mo
%lang(sl)	%{__prefix}/*/locale/sl/LC_MESSAGES/popt.mo
%lang(sr)	%{__prefix}/*/locale/sr/LC_MESSAGES/popt.mo
%lang(sv)	%{__prefix}/*/locale/sv/LC_MESSAGES/popt.mo
%lang(tr)	%{__prefix}/*/locale/tr/LC_MESSAGES/popt.mo
%lang(uk)	%{__prefix}/*/locale/uk/LC_MESSAGES/popt.mo
%lang(wa)	%{__prefix}/*/locale/wa/LC_MESSAGES/popt.mo
%lang(zh)	%{__prefix}/*/locale/zh/LC_MESSAGES/popt.mo
%lang(zh_CN)	%{__prefix}/*/locale/zh_CN/LC_MESSAGES/popt.mo
%lang(zh_TW)	%{__prefix}/*/locale/zh_TW/LC_MESSAGES/popt.mo

# XXX These may end up in popt-devel but it hardly seems worth the effort.
%{__libdir}/libpopt.a
%{__libdir}/libpopt.la
%{__libdir}/libpopt.so
%{__includedir}/popt.h

%changelog
* Mon Nov  7 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.40
- generate executable(foo) run-time shell requirements, opt-in for now.
- fix: python/rpmte-py.c te.Key() return needs Py_INCREF(Key).
- fix: stablize tagValue() sort, prefer longest name.
- eliminate RPMTAG_{SERIAL,COPYRIGHT} names (for sort stability;-).

* Sun Nov  6 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.38
- autogenerate libtool *.la dependencies (#159221).
- autogenerate pkgconfig *.pc dependencies (#159235).
- add brp-nobuildrootpath to scrub $RPM_BUILD_ROOT from *.la and *.pc.
- fix: rescusitate doxygen doco, don't bother tools/dump.c.

* Sat Nov  5 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.37
- use bsearch to speed up tagname() and tagvalue().
- display tag value and type with rpmquery -v --querytags.
- remove tag{Name,Value,Type} from the ABI, rpmTags vectors instead.
- add Requires: %%%%{rpm_license_check} to rpm packaging.
- add Requires: getconf(GNU_LIBPTHREAD_VERSION) = NPTL to rpm packaging.
- resurrect a rpm-perl subpackage from perl-RPM2-0.66.

* Fri Nov  4 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.35
- fix: wipe setuid/setgid bits on updated files (#125517).
- python: add optional transaction id goal to ts.IDTX{load,glob}.

* Thu Nov  3 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.34
- add -lresolv and build on CentOS3.

* Wed Nov  2 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.33
- python: add python peculier build macros (#120635).
- popt: support for lone dashes (#129944).
- permit Build{Suggests,Enhances}: and BuildRequires(hint): (#114338).
- divvy up locale specific man pages between sub-pkgs (#146842).
- perl: handle the 'v' in "use v5.6.0" (#140597).
- add run-time perl(...) provides name space dependency set.

* Tue Nov  1 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.31
- add access(2) run-time probe dependencies.

* Mon Oct 31 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.30
- update to file-4.16 internal.

* Sun Oct 30 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.29
- implement %triggerprein scriptlets.
- fix: unlink __db* files if dbenv->open returns EINVAL.
- fix: attempt solve db open only once.
- python: change ts.check callback, pass rpmds, not TagN, N, EVR, Flags.
- python: set pkgorigin in hdr by extracting from yum (h,path) pkgkey.

* Sat Oct 29 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.28
- add /etc/ld.so.cache provides as a dependency name space set.
- fix: remove context markers from :depflags format modifier.
- permit Requires:/Conflicts: macro expand probes during rpmtsCheck().
- Suggests: and Enhances: spec syntax, synonym(s) for Requires(hint):.
- add suggests/enhances header extensions with --query.
- add --suggests and --enhances popt aliases for header extensions.

* Fri Oct 28 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.27
- upgrade to db-4.4.11 internal.

* Thu Oct 27 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.26
- add getconf(1) provides as a dependency name space set.

* Wed Oct 26 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.25
- permit Requires: hints.
- convert changelogs to utf8 on input and output (#140050).

* Tue Oct 25 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.23
- use generic /usr/src/rpm path for building instead.
- don't check /usr/local routinely when configuring (#116709).

* Mon Oct 24 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.22
- python: bindings for rpmds{Search,Cpuinfo,Rpmlib,Sysinfo}.

* Sun Oct 23 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.21
- add cpuinfo(foo) dependency name space to map /proc/cpuinfo provides.
- add rpmlib(foo) dependency name space to map rpmlib provides.
- eliminate rpmCheckRpmlibProvides(), use rpmdsSearch() instead.
- eliminate rpmGetRpmlibProvides(), use rpmdsRpmlib() instead.
- eliminate rpmShowRpmlibProvides(), print rpmdsRpmlib() instead.
- add system configurable provides read from /etc/rpm/sysinfo.
- display sysinfo/cpuinfo provides with --showrc iff --verboose.
- fix: boundary case segfault in rpmdsSearch.

* Sat Oct 22 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.18
- rollback: merge latest hackery for composting.
- upgrade same NEVR with --force if not literally identical (#134388).

* Fri Oct 21 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.16
- upgrade to db-4.3.29.
- add --target to rpm queries.
- rollback: add --rbexclude tid option.

* Wed Oct  5 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.15
- eliminate rpmtsGetKeys() and ancient ts.getKeys() python method.

* Tue Oct  4 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.14
- add path to *.rpm package into rpmdb/repackaged headers.
- track many-to-many relation between installed and erased packages.

* Fri Sep 30 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.13
- rpmluaFree: substitute globalLuaState for NULL arg.

* Tue Sep 27 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.12
- add --dupes popt alias.
- identify headers from whence they came.

* Thu Sep 22 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.11
- remove gcc warning from popt and rpmio compilation.
- rpmdb.c: remove need to include rpmio_internal.h.

* Fri Sep 16 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.10
- add symbol versions everywhere, proof-of-concept.
- don't re-export zlib-in-rpmio and bdb-in-rpmdb symbols.

* Thu Sep 15 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.8
- fix: revert to older/slower perldeps avoid getOutputFrom() error.
- zlib: uniqify several more symbols.
- re-build against wraptastic,org packaging.

* Wed Sep 14 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.6
- build against neon-0.25.3.

* Tue Aug 30 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.5
- update uk.po (#142740).
- fix: check-prereqs typo (#147196).
- remove all uses of RPMSENSE_PREREQ.

* Thu Aug 25 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.4
- sqlite: path to find internal sqlite3.h
- debuginfo: canonicalize paths (#165434).
- debuginfo: pass --remove-comment switch (#165418).
- java: add automagic req/prov extractors and closure helper (#164953).
- statically link rpmi and rpm again again again.

* Tue Aug 16 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.2
- ignore %excluded files for size
- add debugging labels for pre/post trans scriptlet execution.

* Mon Jul 25 2005 Jeff Johnson <jbj@jbj.org> 4.4.3-0.1
- start 4.4.3 devel.
- put a --stats stopwatch on rpmReadPackageFile() I/O.
