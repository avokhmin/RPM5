##
##  devtool.conf -- Development Tool Configuration for RPM 5
##

%common
    MODULE_NAMES="beecrypt gpsee libgit2 lua neon popt rc syck"
    MODULE_TAG_BASH=""		# XXX bash is GPLv2 and cannot be bundled w RPM
    MODULE_TAG_BEECRYPT="rpm-5_4"
    MODULE_TAG_DB=""
    MODULE_TAG_FICL=""
    MODULE_TAG_FILE=""
    MODULE_TAG_GPSEE=""
    MODULE_TAG_JS_SRC=""
    MODULE_TAG_LIBGIT2=""
    MODULE_TAG_LUA="rpm-5_4"
    MODULE_TAG_NEON="rpm-5_4"
    MODULE_TAG_PCRE=""
    MODULE_TAG_POPT=""
    MODULE_TAG_RC=""
    MODULE_TAG_SYCK="rpm-5_4"
    MODULE_TAG_XAR=""
    MODULE_TAG_XZ=""

%checkout
    for name in $MODULE_NAMES "$@"; do
      case "${name}" in
      libgit2)
            if [ -d ${DEVTOOL_SRCDIR}/${name}/.git ]; then
	        gitcmd="git pull"
                echo "===> ${name} (${gitcmd})"
                ( cd ${DEVTOOL_SRCDIR}/${name} && ${gitcmd} )
            else
	        gitcmd="git clone git://github.com/libgit2/libgit2.git"
                echo "===> ${name} (${gitcmd})"
                ( cd ${DEVTOOL_SRCDIR} && ${gitcmd} )
	    fi
        ;;
      gpsee)
            if [ -d ${DEVTOOL_SRCDIR}/${name}/.hg ]; then
	        cmd="hg fetch"
                echo "===> ${name} (${cmd})"
                ( cd ${DEVTOOL_SRCDIR}/${name} && ${cmd} )
            else
	        cmd="hg clone https://bitbucket.org/wesgarland/gpsee-rpm gpsee"
                echo "===> ${name} (${cmd})"
                ( cd ${DEVTOOL_SRCDIR} && ${cmd} )
	    fi
        ;;
      *)
        release=MODULE_TAG_`echo ${name} | tr '[a-z/]' '[A-Z_]'`
        release=`eval echo \\$${release}`
        if [ ".${release}" = . ]; then
            if [ -d ${DEVTOOL_SRCDIR}/${name}/CVS ]; then
                echo "===> ${name} (cvs up HEAD)"
                ( cd ${DEVTOOL_SRCDIR}/${name} && cvs -q up -A -P -d )
            else
                echo "===> ${name} (cvs co HEAD)"
                ( cd ${DEVTOOL_SRCDIR} && cvs co -A -d ${name} ${name} )
            fi
        else
            if [ -d ${DEVTOOL_SRCDIR}/${name}/CVS ]; then
                echo "===> ${name} (cvs up ${release})"
                ( cd ${DEVTOOL_SRCDIR}/${name} && cvs -q up -P -d -r${release} )
            else
                echo "===> ${name} (cvs co ${release})"
                ( cd ${DEVTOOL_SRCDIR} && cvs co -r${release} -d ${name} ${name} )
            fi
        fi
	;;
      esac
      echo "<=== ${name}"
    done

%autogen
    ( cd ${DEVTOOL_SRCDIR} && sh autogen.sh )

%configure
    ${DEVTOOL_SRCDIR}/configure \
        --verbose \
        "$@"

%make
    #   intentionally just a pass-through target
    #   (important for use with devtool.bashrc)
    make "$@"

%prepare
    %checkout
    %autogen
    %configure "$@"

%jbj
    %checkout
    %system

#        --with-perlembed=/usr/lib/perl5/5.10.0/i386-linux-thread-multi/CORE:/usr/lib/perl5/CORE \
#        --enable-pcregrep-libz \
#        --enable-pcregrep-libbz2 \
#        --enable-pcretest-libreadline \
#        --with-ssl=openssl \
#
%system
    #   configure RPM 5 with maximum internal (independence) and maximum
    #   external (reusability) extend as it usually is the case when
    #   building and running RPM as the system package manager on a
    #   Linux-based system like Fedora. This requires both the latest
    #   development tools and the third-party libraries to be installed
    #   in system locations.
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --enable-shared \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --without-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --without-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --without-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=external \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.6 \
        --with-perl \
        --without-perlembed \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

%static
    #   configure RPM 5 for static linking.
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --disable-shared \
        --with-db=internal \
        --with-dbsql=internal \
        --with-db-tools-integrated \
        --with-zlib=system \
        --with-bzip2=no \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --without-augeas \
        --with-beecrypt=internal \
        --with-gcrypt \
        --without-tomcrypt \
        --with-pcre=internal \
        --enable-utf8 \
        --with-uuid=system \
        --with-popt=system \
        --with-pthreads=yes \
        --with-libelf=yes \
        --with-js=internal \
        --with-lua=internal \
        --with-openssl=system \
        --with-neon=internal \
        --with-syck=internal \
        --without-keyutils \
        --without-xar \
        --without-sqlite \
        --without-nss \
        --with-selinux=no \
        --with-sepol=no \
        --with-semanage=no \
        --without-ruby \
        --without-perl \
        --without-python \
        --enable-build-static \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# Lion
#        --with-ruby=/opt/local/lib/ruby/1.8 \
%falmouth
    %autogen
    %configure \
        --verbose \
        --prefix=/opt/local \
        --enable-shared \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/opt/local/share/misc/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --with-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --with-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=external \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --with-uuid=/opt/local/lib:/opt/local/include/ossp \
        --without-attr \
        --without-acl \
        --with-xar=/opt/local/lib:/opt/local/include/xar \
        --with-popt=internal \
        --without-keyutils \
        --with-pthreads \
        --without-libelf \
        --with-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python=system \
        --with-pythonembed=/usr/lib:/usr/include/python2.6 \
        --with-perl \
        --with-perlembed=/opt/local/lib/perl5/5.12.3/darwin-multi-2level/CORE \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --with-libgit2=internal \
        --without-squirrel \
        --with-installed-readline \
        --with-valgrind \
        --disable-openmp \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# Leopard Server on dual G5
%eastham
    %autogen
    %configure \
        --verbose \
        --prefix=/opt/local \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/opt/local/share/misc/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --without-augeas \
        --with-beecrypt=internal \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --with-tomcrypt \
        --without-tpm \
        --without-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=external \
        --without-libroxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --with-uuid=/opt/local/lib:/opt/local/include/ossp \
        --without-attr \
        --without-acl \
        --with-xar=/opt/local/lib:/opt/local/include/xar \
        --with-popt=internal \
        --without-keyutils \
        --with-pthreads \
        --without-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/opt/local/lib:/opt/local/include/python2.5 \
        --with-perl \
        --without-perlembed \
        --with-ruby=/opt/local/lib/ruby/1.8 \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --with-libgit2=internal \
        --without-squirrel \
        --without-valgrind \
        --disable-openmp \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# Fedora 17 (currently F16)
%provincetown
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --enable-shared \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --without-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --with-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --without-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=internal \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --without-pythonembed \
        --with-perl \
        --without-perlembed \
        --with-ruby \
        --with-selinux \
        --with-sepol \
        --with-semanage \
        --with-libgit2=internal \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --disable-openmp \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# CentOS 5.x/x86_64 => Serentos 6.1/x86_64
#  --with-perlembed=/usr/lib64/perl5/5.10.0/x86_64-linux-thread-multi/CORE/:/usr/lib64/perl5/CORE \
%harwich
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --enable-shared \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --with-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --with-tomcrypt \
        --without-tpm \
        --with-libtasn1 \
        --with-pakchois \
        --with-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --with-uuid=system \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=internal \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --with-rc \
        --without-js \
        --with-gpsee=internal \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.6 \
        --with-perl \
        --with-perlembed=/usr/lib64/perl5/CORE/:/usr/lib64/perl5/CORE \
        --with-ruby=/usr/lib64:/usr/lib64/ruby/1.8 \
        --with-selinux \
        --with-sepol \
        --with-semanage \
        --with-libgit2=internal \
        --with-apr \
        --with-subversion \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-openmp \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# CentOS 5.x/i386 => Serentos 6.1/i386
#  --with-perlembed=/usr/i386/perl5/5.10.0/i386-linux-thread-multi/CORE/:/usr/lib/perl5/CORE \
%hyannis
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --enable-shared \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --with-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --with-tomcrypt \
        --without-tpm \
        --with-libtasn1 \
        --with-pakchois \
        --with-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --with-uuid=system \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=internal \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.6 \
        --with-perl \
        --with-perlembed=/usr/lib/perl5/CORE/:/usr/lib/perl5/CORE \
        --with-ruby=/usr/lib:/usr/lib/ruby/1.8 \
        --with-selinux \
        --with-sepol \
        --with-semanage \
        --with-libgit2=internal \
        --with-apr \
        --with-subversion \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-openmp \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# Fedorable 16
#  --with-perlembed=/usr/lib64/perl5/5.10.0/x86_64-linux-thread-multi/CORE/:/usr/lib64/perl5/CORE \
%truro
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --enable-shared \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --with-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --with-tomcrypt \
        --without-tpm \
        --with-libtasn1 \
        --with-pakchois \
        --with-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --with-uuid=system \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=internal \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.7 \
        --with-perl \
        --with-perlembed=/usr/lib64/perl5/CORE/:/usr/lib64/perl5/CORE \
        --with-ruby=/usr/lib64:/usr/lib64/ruby/1.8 \
        --with-selinux \
        --with-sepol \
        --with-semanage \
        --with-libgit2=internal \
        --with-apr \
        --with-subversion \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-openmp \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# RHEL6x
%plymouth
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --enable-shared \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --without-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --without-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --without-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.6 \
        --with-perl \
        --without-perlembed \
        --with-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# Momonga 7
%momonga
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --enable-shared \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --without-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --without-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --without-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=external \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.6 \
        --without-perl \
        --without-perlembed \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# OpenMAMBA
#        --with-ruby=/usr/lib:/usr/lib/ruby/1.8/i586-linux/ \
%openmamba
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/misc/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --with-augeas \
        --with-beecrypt=internal \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --with-libtasn1 \
        --with-pakchois \
        --with-gnutls \
        --with-neon=internal \
        --without-libroxy \
        --with-expat \
        --without-libxml2 \
        --with-pcre \
        --enable-utf8 \
        --with-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=internal \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.6 \
        --with-perl \
        --without-perlembed \
	--with-perlembed=/usr/lib:/usr/lib/perl5/5.10.1/i386-linux-thread-multi/CORE/ \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# Caixa Magica 14
%cm14
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/misc/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --with-augeas \
        --with-beecrypt=internal \
        --with-openssl \
        --without-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --with-libtasn1 \
        --with-pakchois \
        --with-gnutls \
        --with-neon=external \
        --without-libroxy \
        --without-expat \
        --with-libxml2 \
        --with-pcre \
        --enable-utf8 \
        --with-uuid=system \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=internal \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.6 \
        --without-perl \
        --without-perlembed \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# Caixa Magica 15x
%cm15x
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/misc/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --with-augeas \
        --with-beecrypt=internal \
        --with-openssl \
        --without-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --with-libtasn1 \
        --with-pakchois \
        --with-gnutls \
        --with-neon=external \
        --without-libroxy \
        --without-expat \
        --with-libxml2 \
        --with-pcre \
        --enable-utf8 \
        --without-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=internal \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.6 \
        --without-perl \
        --without-perlembed \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# Mandriva 2011.0
%mandriva
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/misc/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --with-augeas \
        --with-beecrypt=internal \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --with-libtasn1 \
        --with-pakchois \
        --with-gnutls \
        --with-neon=external \
        --without-libroxy \
        --without-expat \
        --with-libxml2 \
        --with-pcre \
        --enable-utf8 \
        --with-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=internal \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.7 \
        --with-perl \
        --with-perlembed=/usr/lib64:/usr/lib/perl5/5.12.2/x86_64-linux-thread-multi/CORE/ \
        --with-ruby=/usr/lib64:/usr/lib/ruby/1.8/x86_64-linux/ \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# Mandriva Linux Cooker
%cooker
    export CFLAGS="-O2 -g -frecord-gcc-switches -Wstrict-aliasing=2 -pipe -Wformat -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector --param=ssp-buffer-size=4"
    export CXXFLAGS="$CFLAGS"
    export LDFLAGS="-Wl,--as-needed -Wl,--no-undefined -Wl,-z,relro -Wl,-O1 -Wl,--build-id -Wl,--enable-new-dtags"

    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/misc/magic \
        --with-lua=external \
        --with-tcl \
        --with-sqlite \
        --with-syck=external \
        --with-readline \
        --with-augeas \
        --with-beecrypt=external \
        --with-openssl \
        --without-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --with-libtasn1 \
        --with-pakchois \
        --with-gnutls \
        --with-neon=external \
        --without-libroxy \
        --without-expat \
        --with-libxml2 \
        --with-pcre \
        --enable-utf8 \
        --with-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=external \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --without-pythonembed \
        --with-perl=vendor \
        --without-perlembed \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --with-cpuinfo \
        --with-vendor=mandriva \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode \
        --with-extra-path-macros=/usr/lib/rpm/platform/%{_target}/macros:/usr/lib/rpm/mandriva/platform/%{_target}/macros:/etc/rpm/macros.d/*.macros:/usr/lib/rpm/macros.d/mandriva
        echo '#define PREMACROFILES "/etc/rpm/premacros.d/*.macros"' >> config.h

# FreeBSD 8.1 x86_64
%fbsd8x
    %autogen
    LOCALBASE=/usr/local
    PREFIX=${LOCALBASE}
    sed -i -E -e "s:\$(libdir)/pkgconfig:${PREFIX}/libdata/pkgconfig:" \
            scripts/Makefile.in
    CPPFLAGS="-I${LOCALBASE}/include -I${LOCALBASE}/include/xar"
    LDFLAGS="-L${LOCALBASE}/lib"
    export CPPFLAGS
    export LDFLAGS
    %configure \
        --verbose \
        --prefix=${PREFIX} \
        --sysconfdir=${PREFIX}/etc \
        --with-path-cfg=${PREFIX}/etc/rpm \
        --mandir=${PREFIX}/man \
        --infodir=${PREFIX}/info \
        --with-apidocs \
        --enable-shared \
        --with-db=${PREFIX}/lib/db51:${PREFIX}/include \
        --with-dbsql=${PREFIX}/lib/db51:${PREFIX}/include \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=${PREFIX}/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --without-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --without-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=external \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --with-uuid \
        --without-attr \
        --without-acl \
        --with-xar \
        --with-popt=internal \
        --without-keyutils \
        --with-pthreads \
        --without-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=${PREFIX}/lib:${PREFIX}/include/python2.6 \
        --with-perl \
        --without-perlembed \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-installed-readline \
        --without-valgrind \
        --disable-openmp \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# ubuntu 10.10 Maverick Meerkat
%ubuntu
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --without-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --without-nss \
        --with-gcrypt \
        --with-tomcrypt \
        --without-tpm \
        --without-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --without-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=internal \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --without-pythonembed \
        --with-perl \
        --without-perlembed \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --disable-openmp \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# dreamplug
%dreamplug
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --without-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --without-augeas \
        --with-beecrypt=internal \
        --without-cplusplus \
        --without-java \
        --with-openssl \
        --without-nss \
        --with-gcrypt \
        --with-tomcrypt \
        --without-tpm \
        --without-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --without-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt=internal \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --without-pythonembed \
        --with-perl \
        --without-perlembed \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --disable-openmp \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# CentOS 4.x
%centos4
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --without-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-gcrypt \
        --with-nss \
        --with-openssl \
        --without-tomcrypt \
        --with-pcre \
        --enable-utf8 \
        --without-uuid \
        --with-popt=internal \
        --with-pthreads=yes \
        --with-libelf \
        --without-js \
        --without-gpsee \
        --with-neon=internal \
        --without-libproxy \
        --without-gssapi \
        --with-expat \
        --with-syck=internal \
        --with-keyutils \
        --without-xar \
        --without-sqlite \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --with-python \
        --without-perl \
        --without-ruby \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# CentOS 5.x
%centos
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/misc/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --without-readline \
        --without-augeas \
        --with-beecrypt=internal \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --without-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --without-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --without-python \
        --without-pythonembed \
        --without-perl \
        --without-perlembed \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --without-valgrind \
        --enable-openmp \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# OpenIndiana on x86
%indiana
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --enable-shared \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --without-xz \
        --with-file \
        --with-path-magic=/usr/share/mime/magic \
        --without-lua \
        --with-tcl \
        --without-sqlite \
        --without-syck \
        --with-readline \
        --without-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --without-nss \
        --without-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --without-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --without-uuid \
        --without-attr \
        --without-acl \
        --without-xar \
        --with-popt=external \
        --without-keyutils \
        --with-pthreads \
        --without-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --without-python \
        --without-pythonembed \
        --without-perl \
        --without-perlembed \
        --without-ruby \
        --without-selinux \
        --without-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --without-valgrind \
        --enable-build-pic \
        --disable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

%opensuse
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --enable-shared \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/file/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --without-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --without-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --without-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.7 \
        --with-perl \
        --without-perlembed \
        --with-ruby \
        --with-selinux \
        --with-sepol \
        --with-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

%sles11
    %autogen
    %configure \
        --verbose \
        --prefix=/usr \
        --enable-shared \
        --with-db \
        --with-dbsql \
        --without-db-tools-integrated \
        --with-zlib \
        --with-bzip2 \
        --with-xz \
        --with-file \
        --with-path-magic=/usr/share/misc/magic \
        --with-lua=internal \
        --with-tcl \
        --without-sqlite \
        --with-syck=internal \
        --with-readline \
        --with-augeas \
        --with-beecrypt=internal \
        --without-java \
        --with-openssl \
        --with-nss \
        --with-gcrypt \
        --without-tomcrypt \
        --without-tpm \
        --without-libtasn1 \
        --without-pakchois \
        --without-gnutls \
        --with-neon=internal \
        --without-libproxy \
        --with-expat \
        --with-pcre \
        --enable-utf8 \
        --without-uuid \
        --with-attr \
        --with-acl \
        --without-xar \
        --with-popt \
        --with-keyutils \
        --with-pthreads \
        --with-libelf \
        --without-cudf \
        --without-ficl \
        --without-aterm \
        --without-nix \
        --without-bash \
        --without-rc \
        --without-js \
        --without-gpsee \
        --with-python \
        --with-pythonembed=/usr/lib:/usr/include/python2.6 \
        --with-perl \
        --without-perlembed \
        --with-ruby \
        --with-selinux \
        --with-sepol \
        --without-semanage \
        --without-squirrel \
        --with-build-extlibdep \
        --with-build-maxextlibdep \
        --with-valgrind \
        --enable-build-pic \
        --enable-build-versionscript \
        --enable-build-warnings \
        --enable-build-debug \
        --enable-maintainer-mode

# CC=ccache env UMASK=022 distcc cc
# CFLAGS=-O2 -g -m32 -march=pentium-mmx -fasynchronous-unwind-tables -I/usr/include/python2.5 -I/usr/include/beecrypt
# CXX=ccache env UMASK=022 distcc g++
# CXXFLAGS=-O2 -g -m32 -march=pentium-mmx -fasynchronous-unwind-tables
# --with-path-lib=\"/usr/lib/rpm\"
%wildpikachu
    %checkout
    %autogen
    %configure \
        --prefix=/usr \
        --sysconfdir=/etc \
        --localstatedir=/var \
        --infodir=/usr/share/info \
        --mandir=/usr/share/man \
        --libdir=/usr/lib \
        --without-selinux \
        --disable-dependency-tracking \
        --with-perl \
        --with-python \
        --with-sqlite \
        --with-pcre \
        --with-bzip2 \
        --with-openssl \
        --with-file \
        --with-libelf \
        --disable-rpath \
        --without-lua

%fray-cross
    %checkout
    %autogen
    %configure \
        --disable-nls \
        --with-libelf \
        --without-selinux \
        --without-perl \
        --with-python=2.4 \
        --with-zlib \
        --with-bzip2 \
        --with-beecrypt \
        --without-neon \
        --with-file=internal \
        --with-popt \
        --with-sqlite \
        --with-dbapi=sqlite \
        --with-db=internal \
        --with-lua=internal \
        --without-apidocs \
        --with-path-macros=... \
        --with-bugreport=support@windriver.com

%fray-target
    %checkout
    %autogen
    %configure \
        --disable-nls \
        --with-file=internal \
        --with-db=internal \
        --with-lua=internal \
        --without-apidocs \
        --with-beecrypt \
        --with-popt \
        --with-bugreport=support@windriver.com

%windriver-host
    RPM_VENDOR_WINDRIVER=1
    export RPM_VENDOR_WINDRIVER
    %checkout
    %autogen
    %configure \
        --prefix=/usr \
        --with-path-lib=/usr/lib/rpm \
        --with-python-lib-dir=/usr/lib/python2.5 \
        --disable-nls \
        --disable-rpath \
        --with-libelf \
        --without-selinux \
        --without-perl \
        --with-python=2.5 \
        --with-zlib=external \
        --with-bzip2=external \
        --with-beecrypt=external \
        --without-neon \
        --with-file=internal \
        --with-popt=external \
        --with-sqlite=external \
        --with-dbapi=sqlite \
        --with-db=internal \
        --with-lua=internal \
        --without-apidocs \
        --with-path-macros='%{_usrlibrpm}/macros:%{_usrlibrpm}/wrs/macros:%{_usrlibrpm}/wrs/%{_target}/macros:~/.wrsrpmmacros' \
        --with-bugreport=support@windriver.com \
        --verbose \
        --with-db-tools-integrated \
        --with-pcre \
        --without-xz \
        --without-openssl \
        --without-nss \
        --without-gcrypt \
        --without-uuid \
        --without-xar \
        --without-keyutils

%windriver-target
    RPM_VENDOR_WINDRIVER=1
    export RPM_VENDOR_WINDRIVER
    %checkout
    %autogen
    %configure \
        --prefix=/usr \
        --disable-nls \
        --disable-rpath \
        --with-libelf \
        --with-selinux \
        --with-perl \
        --with-python=2.5 \
        --with-zlib=external \
        --with-bzip2=external \
        --with-beecrypt=external \
        --with-neon \
        --with-file=internal \
        --with-popt=external \
        --with-sqlite=external \
        --with-db=internal \
        --with-lua=internal \
        --without-apidocs \
        --with-path-macros='%{_usrlibrpm}/macros:%{_usrlibrpm}/wrs/macros:%{_usrlibrpm}/wrs/default-linux/macros:%{_usrlibrpm}/wrs/%{_target}/macros:%{_etcrpm}/macros.*:%{_etcrpm}/macros:%{_etcrpm}/%{_target}/macros:~/.wrsrpmmacros' \
        --with-bugreport=support@windriver.com \
        --verbose \
        --with-db-tools-integrated \
        --with-pcre \
        --without-xz \
        --without-openssl \
        --without-nss \
        --without-gcrypt \
        --without-uuid \
        --without-xar \
        --without-keyutils

%fedora
    ##
    ## Provision a fedora host sufficiently to build from cvs.
    PKGS="\
        perl-devel \
        python-devel \
        uuid-devel \
        libgcrypt-devel \
        beecrypt-devel \
        nss-devel \
        sqlite-devel \
        libxml2-devel \
        neon-devel \
        bzip2-devel \
        zlib-devel \
        pcre-devel \
        keyutils-libs-devel \
        elfutils-libelf-devel \
        gettext-devel \
        popt-devel \
        automake \
        autoconf \
        byacc \
        cvs \
        libtool \
        gcc \
        gcc-c++ \
        gettext \
        make \
        pkgconfig \
    "
    sudo yum -y install $PKGS

%rse
    %standalone

%openpkg
    RPM_VENDOR_OPENPKG=1
    export RPM_VENDOR_OPENPKG
    %standalone

%standalone
    ##
    ##  USE THIS DEVELOPER PROCEDURE IF YOU WANT TO REALLY
    ##  TEST-DRIVE RPM 5 ON ARBITRARY UNIX FLAVORS!
    ##
    ##  This developer procedure is for _fully_ stand-alone building RPM
    ##  5 on arbitrary Unix platforms and with a rather large functional
    ##  extend. It is very close to the procedure OpenPKG will use to
    ##  build RPM 5 in its "bootstrap" package ("openpkg") and hence
    ##  can be used to build RPM 5 from source and on a large number of
    ##  Unix flavors without any additional prerequisites (except the
    ##  development tools, of course). It especially doesn't require
    ##  any of the third-party libraries to be pre-installed in the
    ##  system. Instead it downloads and builds (and *not* installs)
    ##  them side-by-side with RPM 5.
    ##
    ##  NOTICE: As OpenPKG is mainly about using RPM in a true
    ##  stand-alone, self-contained and cross-platform environment,
    ##  this procedure unfortunately is a rather complex one as all(!)
    ##  third-party libraries are required to be built from scratch and
    ##  on arbitrary Unix platforms. This inherently requires lots of
    ##  fiddling with their build environment. Just treat the prepare()
    ##  function below as opaque and do not think about it. It just
    ##  contains all the essential parts of the OpenPKG .spec files for
    ##  achieving this. Nevertheless this whole procedure is completely
    ##  independent of any OpenPKG instance itself, of course.
    ##
    ##  This procedure was used by Ralf S. Engelschall to successfully
    ##  build RPM 5 under at least the following particular Unix
    ##  platforms (each one defined by the combination of hardware
    ##  architecture, operating system and compiler):
    ##
    ##  o 2007-11-11: ix86-freebsd6.2-gcc4.2.2
    ##  o 2007-11-11: ix86-freebsd6.2-gcc4.3.0s20071109
    ##  o 2007-07-17: ix86-freebsd6.2-gcc3.4
    ##  o 2007-07-17: amd64-freebsd6.2-gcc4.1.2
    ##  o 2007-07-17: ix86-freebsd7.0-gcc4.1.2
    ##  o 2007-07-17: ia64-freebsd6.2-gcc4.1.2
    ##  o 2007-07-18: ix86-fedora7-gcc4.2.0
    ##  o 2007-07-19: ix86-fedora7-sunstudio12
    ##  o 2007-07-19: ix86-fedora7-icc10.0
    ##  o 2007-07-17: ix86-debian3.1-gcc4.1.2
    ##  o 2007-07-17: ix86-debian4.0-gcc4.2.0
    ##  o 2007-07-17: ix86-rhel4-gcc4.1.2
    ##  o 2007-07-17: ix86-solaris9-gcc4.1.2
    ##  o 2007-07-17: sparc64-solaris8-gcc4.1.2
    ##  o 2007-11-12: sparc64-solaris9-gcc4.1.2
    ##  o 2007-11-12: sparc64-solaris10-gcc4.1.2
    ##  o 2007-07-17: amd64-solaris10-gcc4.1.2
    ##  o 2007-07-24: ppc-macosx10.4-gcc4.0.1
    ##  o 2007-07-25: ppc-aix5.3-gcc3.3.2
    ##

    #   source reusable companion modules
    @source %standalone-modules

    #   execute implicit shared modules
    standalone_defines
    standalone_prerequisite

    #   execute explicit requested module
    [ $# -eq 0 ] && set -- all
    cmd="standalone_$1"; shift
    ( eval $cmd ${1+"$@"} ) 2>&1

%standalone-modules
    standalone_defines () {
        #   third-party development tools distribution versions
        v_m4="1.4.13"
        v_autoconf="2.63"
        v_automake="1.11"
        v_libtool="2.2.6a"
        v_libtool_subdir="2.2.6"
        v_gettext="0.17"

        #   third-party library distribution versions
        v_zlib="1.2.3"
        v_bzip2="1.0.5"
        v_xz="4.999.8beta"
        v_openssl="0.9.8k"
        v_expat="2.0.1"
        v_neon="0.28.4"
        v_beecrypt="4.2.1"
        v_db="4.7.25"
        v_sqlite="3.6.14.2"
        v_lua="5.1.4"
        v_file="5.00"
        v_popt="1.15"
        v_libxml2="2.7.3"
        v_xar="1.5.2"
        v_pcre="7.9"
        v_uuid="1.6.2"
        v_config="20090412"

        #   third-party distribution files
        dist=""
        dist="${dist} m4-${v_m4}.tar.gz,http://rpm5.org/files/3rd/,ftp://ftp.gnu.org/gnu/m4/"
        dist="${dist} autoconf-${v_autoconf}.tar.gz,http://rpm5.org/files/3rd/,ftp://ftp.gnu.org/gnu/autoconf/"
        dist="${dist} automake-${v_automake}.tar.gz,http://rpm5.org/files/3rd/,ftp://ftp.gnu.org/gnu/automake/"
        dist="${dist} libtool-${v_libtool}.tar.gz,http://rpm5.org/files/3rd/,ftp://ftp.gnu.org/gnu/libtool/"
        dist="${dist} gettext-${v_gettext}.tar.gz,http://rpm5.org/files/3rd/,ftp://ftp.gnu.org/gnu/gettext/"
        dist="${dist} zlib-${v_zlib}.tar.gz,http://rpm5.org/files/3rd/,http://www.zlib.net/"
        dist="${dist} bzip2-${v_bzip2}.tar.gz,http://rpm5.org/files/3rd/,http://www.bzip.org/${v_bzip2}/"
        dist="${dist} xz-${v_xz}.tar.gz,http://rpm5.org/files/3rd/,http://tukaani.org/xz/"
        dist="${dist} openssl-${v_openssl}.tar.gz,http://rpm5.org/files/3rd/,ftp://ftp.openssl.org/source/"
        dist="${dist} expat-${v_expat}.tar.gz,http://rpm5.org/files/3rd/,http://switch.dl.sourceforge.net/expat/"
        dist="${dist} neon-${v_neon}.tar.gz,http://rpm5.org/files/3rd/,http://www.webdav.org/neon/"
        dist="${dist} beecrypt-${v_beecrypt}.tar.gz,http://rpm5.org/files/3rd/,http://switch.dl.sourceforge.net/beecrypt/"
        dist="${dist} db-${v_db}.tar.gz,http://rpm5.org/files/3rd/,http://download-uk.oracle.com/berkeley-db/"
        dist="${dist} sqlite-${v_sqlite}.tar.gz,http://rpm5.org/files/3rd/,http://www.sqlite.org/"
        dist="${dist} lua-${v_lua}.tar.gz,http://rpm5.org/files/3rd/,http://www.lua.org/ftp/"
        dist="${dist} file-${v_file}.tar.gz,http://rpm5.org/files/3rd/,ftp://ftp.astron.com/pub/file/"
        dist="${dist} popt-${v_popt}.tar.gz,http://rpm5.org/files/3rd/,http://rpm5.org/files/popt/"
        dist="${dist} libxml2-${v_libxml2}.tar.gz,http://rpm5.org/files/3rd/,ftp://xmlsoft.org/libxml2/"
        dist="${dist} xar-${v_xar}.tar.gz,http://rpm5.org/files/3rd/,http://xar.googlecode.com/files/"
        dist="${dist} pcre-${v_pcre}.tar.gz,http://rpm5.org/files/3rd/,ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/"
        dist="${dist} uuid-${v_uuid}.tar.gz,http://rpm5.org/files/3rd/,ftp://ftp.ossp.org/pkg/lib/uuid/"

        #   third-party distribution patches (for portability and bugfix reasons only)
        dist="${dist} automake-${v_automake}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} gettext-${v_gettext}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} openssl-${v_openssl}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} beecrypt-${v_beecrypt}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} db-${v_db}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} sqlite-${v_sqlite}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} lua-${v_lua}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} file-${v_file}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} popt-${v_popt}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} libxml2-${v_libxml2}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} xar-${v_xar}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} pcre-${v_pcre}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} xz-${v_xz}.patch,http://rpm5.org/files/3rd/"
        dist="${dist} config.guess-${v_config},http://rpm5.org/files/3rd/"
        dist="${dist} config.sub-${v_config},http://rpm5.org/files/3rd/"
    }

    standalone_prerequisite () {
        #   tool prerequisite check
        for tool in gzip tar patch perl; do
            variable=`echo "$tool" | tr '[a-z]' '[A-Z]'`
            eval "val=\"\${$variable+set}\""
            if [ ".$val" = .set ]; then
                eval "$tool=\"\${$variable}\""
            else
                if [ ".`(which $tool) 2>/dev/null | egrep '^/'`" != . ]; then
                    eval "$tool=\"$tool\""
                else
                    echo "devtool:ERROR: sorry, \"$tool\" required in \$PATH (or set \$$variable)" 1>&2
                    exit 1
                fi
            fi
            eval "export $tool"
        done

        #   determine compiler (to make sure the whole library and application
        #   chain is built with the same one in order to avoid incompatibilities)
        if [ ".$CC" != . ]; then
            cc="$CC"
        elif [ ".`(which gcc) 2>/dev/null | egrep '^/'`" != . ]; then
            cc="gcc"
        elif [ ".`(which icc) 2>/dev/null | egrep '^/'`" != . ]; then
            cc="icc"
        elif [ ".`(which cc) 2>/dev/null | egrep '^/'`" != . ]; then
            cc="cc"
        else
            echo "devtool:ERROR: sorry, C compiler (\"cc\") required in \$PATH (or set \$CC)" 1>&2
            exit 1
        fi
        if [ ".`(which ccache) 2>/dev/null | egrep '^/'`" != . ]; then
            cc="ccache $cc"
        fi

        #    determine some local tools
        SHTOOL="`cd ${DEVTOOL_SRCDIR} && pwd`/devtool.shtool"

        #   third-party base directory, installation default prefix and platform
        base3rd="${DEVTOOL_SRCDIR}/../3rd"
        prefix="/tmp/rpm"
        platform=`$SHTOOL platform -n -L -S "" -C "+" -F '%<ap>-%<sp>'`
    }

    standalone_download () {
        #   helper function for downloading a file from an URL
        file="$1"
        name=`echo "$file" | sed -e 's;^.*/\([^/]*\)$;\1;'`
        for url in `echo "$2" | sed -e 's/,/ /g'`; do
            echo "-- downloading $url$name"
            if [ ".`(which curl) 2>/dev/null | egrep '^/'`" != . ]; then
                curl -s -o "$file" "$url$name" || continue
            elif [ ".`(which wget) 2>/dev/null | egrep '^/'`" != . ]; then
                wget -q -O "$file" "$url$name" || continue
            elif [ ".`(which fetch) 2>/dev/null | egrep '^/'`" != . ]; then
                fetch -o "$file" "$url$name" || continue
            elif [ ".`(which lwp-download) 2>/dev/null | egrep '^/'`" != . ]; then
                lwp-download "$url$name" "$file" || continue
            else
                echo "devtool:ERROR: sorry, no download tool found in \$PATH (\"curl\", \"wget\", \"fetch\", \"lwp-download\")" 1>&2
                exit 1
            fi
            if [ -f "$file" ]; then
                break
            fi
        done
        if [ ! -f "$file" ]; then
            echo "devtool:ERROR: failed to download \"$name\"" 1>&2
            exit 1
        fi
    }

    #   prepare build environment
    standalone_prepare () {
        echo "++ establishing third-party area under ($base3rd)"
        for dir in "" src bin bin/$platform run run/$platform; do
            if [ ! -d "$base3rd/$dir" ]; then
                mkdir $base3rd/$dir || exit $?
            fi
        done

        echo "++ establishing third-party distribution files ($base3rd/src/)"
        for spec in $dist; do
            file=`echo "$spec" | sed -e 's;,.*$;;'`
            urls=`echo "$spec" | sed -e 's;^[^,]*;;'`
            if [ ! -f "$base3rd/src/$file" ]; then
                standalone_download "$base3rd/src/$file" "$urls" || exit $?
            fi
        done

        #   extend environment
        prefix_tools="`cd $base3rd/run/$platform && pwd`"
        PATH="$prefix_tools/bin:$prefix_tools/sbin:$PATH"
        PATH="$PATH:/bin:/usr/bin:/sbin:/usr/sbin"
        export PATH

        #   GNU m4 (installed development tool)
        if [ ! -d "$base3rd/bin/$platform/m4-${v_m4}" ]; then
            echo "++ building third-party development tool m4-${v_m4}"
            (   cd $base3rd/bin/$platform
                rm -rf m4-${v_m4}
                $gzip -d -c ../../src/m4-${v_m4}.tar.gz | $tar xf -
                (   cd m4-${v_m4}
                    CC="$cc" \
                    GREP="grep" \
                    ./configure \
                        --prefix="$prefix_tools" \
                        --disable-nls
                    make
                    make install
                    rm -f $prefix_tools/bin/gm4
                    ln $prefix_tools/bin/m4 \
                       $prefix_tools/bin/gm4
                ) || exit $?
            ) || exit $?
        fi

        #   GNU autoconf (installed development tool)
        if [ ! -d "$base3rd/bin/$platform/autoconf-${v_autoconf}" ]; then
            echo "++ building third-party development tool autoconf-${v_autoconf}"
            (   cd $base3rd/bin/$platform
                rm -rf autoconf-${v_autoconf}
                $gzip -d -c ../../src/autoconf-${v_autoconf}.tar.gz | $tar xf -
                (   cd autoconf-${v_autoconf}
                    CC="$cc" \
                    ACLOCAL=true \
                    AUTOMAKE=true \
                    AUTOCONF=true \
                    AUTOHEADER=true \
                    MAKEINFO=true \
                    GREP=grep \
                    ./configure \
                        --prefix="$prefix_tools"
                    make
                    make install
                ) || exit $?
            ) || exit $?
        fi

        #   GNU automake (installed development tool)
        if [ ! -d "$base3rd/bin/$platform/automake-${v_automake}" ]; then
            echo "++ building third-party development tool automake-${v_automake}"
            (   cd $base3rd/bin/$platform
                rm -rf automake-${v_automake}
                $gzip -d -c ../../src/automake-${v_automake}.tar.gz | $tar xf -
                (   cd automake-${v_automake}
                    $patch -p0 <../../../src/automake-${v_automake}.patch
                    $SHTOOL subst \
                        -e "s;^\(.SUFFIXES: .*\) \.info \(.*\);\1 \2;" \
                        doc/Makefile.in
                    CC="$cc" \
                    ACLOCAL=true \
                    AUTOMAKE=true \
                    AUTOCONF=true \
                    AUTOHEADER=true \
                    MAKEINFO=true \
                    GREP=grep \
                    ./configure \
                        --prefix="$prefix_tools"
                    make
                    make install
                ) || exit $?
            ) || exit $?
        fi

        #   GNU libtool (installed development tool)
        if [ ! -d "$base3rd/bin/$platform/libtool-${v_libtool_subdir}" ]; then
            echo "++ building third-party development tool libtool-${v_libtool}"
            (   cd $base3rd/bin/$platform
                rm -rf libtool-${v_libtool_subdir}
                $gzip -d -c ../../src/libtool-${v_libtool}.tar.gz | $tar xf -
                (   cd libtool-${v_libtool_subdir}
                    $SHTOOL subst \
                        -e 's;grep ggrep;grep ggrep egrep;g' \
                        -e 's;-e .-(cannot match)-.;;g' \
                        `find . -name configure -print`
                    CC="$cc" \
                    GREP=grep \
                    ./configure \
                        --prefix="$prefix_tools" \
                        --enable-static \
                        --enable-shared
                    make
                    make install
                    rm -f $prefix_tools/bin/glibtoolize
                    ln $prefix_tools/bin/libtoolize \
                       $prefix_tools/bin/glibtoolize
                ) || exit $?
            ) || exit $?
        fi

        #   GNU gettext (installed development tool)
        if [ ! -d "$base3rd/bin/$platform/gettext-${v_gettext}" ]; then
            echo "++ building third-party development tool gettext-${v_gettext}"
            (   cd $base3rd/bin/$platform
                rm -rf gettext-${v_gettext}
                $gzip -d -c ../../src/gettext-${v_gettext}.tar.gz | $tar xf -
                (   cd gettext-${v_gettext}
                    $patch -p0 <../../../src/gettext-${v_gettext}.patch
                    $SHTOOL subst \
                        -e '/localcharset.\$lo/d' \
                        gettext-runtime/intl/Makefile.in
                    $SHTOOL subst \
                        -e 's;\(SUBDIRS.*=.*\)intl-java ;\1;' \
                        -e 's;\(SUBDIRS.*=.*\)intl-csharp ;\1;' \
                         gettext-runtime/Makefile.in
                    $SHTOOL subst \
                        -e 's;^.*intl-java/Makefile.*$;;' \
                        -e 's;^.*intl-csharp/Makefile.*$;;' \
                        gettext-runtime/configure
                    $SHTOOL subst \
                        -e 's;@BUILDJAVA@;no;g' \
                        -e 's;@BUILDJAVAEXE@;no;g' \
                        -e 's;@BUILDCSHARP@;no;g' \
                        gettext-tools/src/Makefile.in
                    $SHTOOL subst \
                        -e 's;^\(SUBDIRS =.*\)tests gnulib-tests examples;\1;' \
                        gettext-tools/Makefile.in
                    $SHTOOL subst \
                        -e 's;\#if USEJEXE;#ifdef USEJEXE;' \
                        gettext-tools/src/read-java.c \
                        gettext-tools/src/urlget.c
                    $SHTOOL subst \
                        -e 's;\(#define LIBXML_ICONV_ENABLED\);\1_DUMMY;' \
                        gnulib-local/lib/libxml/xmlversion.in.h \
                        gettext-tools/gnulib-lib/libxml/xmlversion.in.h
                    CC="$cc" \
                    GREP="grep" \
                    ./configure \
                        --prefix="$prefix_tools" \
                        --without-libiconv-prefix \
                        --with-included-gettext \
                        --without-libexpat-prefix \
                        --disable-libasprintf \
                        --disable-threads \
                        --disable-csharp \
                        --disable-java \
                        --disable-nls \
                        --disable-shared
                    make
                    make install
                ) || exit $?
            ) || exit $?
        fi

        #   ZLib (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/zlib-${v_zlib}" ]; then
            echo "++ building third-party library zlib-${v_zlib}"
            (   cd $base3rd/bin/$platform
                rm -rf zlib-${v_zlib}
                $gzip -d -c ../../src/zlib-${v_zlib}.tar.gz | $tar xf -
                (   cd zlib-${v_zlib}
                    CC="$cc" \
                    ./configure
                    make libz.a
                ) || exit $?
            ) || exit $?
        fi

        #   BZip2 (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/bzip2-${v_bzip2}" ]; then
            echo "++ building third-party library bzip2-${v_bzip2}"
            (   cd $base3rd/bin/$platform
                rm -rf bzip2-${v_bzip2}
                $gzip -d -c ../../src/bzip2-${v_bzip2}.tar.gz | $tar xf -
                (   cd bzip2-${v_bzip2}
                    $patch -p0 <../../../src/bzip2-${v_bzip2}.patch
                    make CC="$cc" CFLAGS="-O" libbz2.a bzip2
                ) || exit $?
            ) || exit $?
        fi

        #   XZ (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/xz-${v_xz}" ]; then
            echo "++ building third-party library xz-${v_xz}"
            (   cd $base3rd/bin/$platform
                rm -rf xz-${v_xz}
                $gzip -d -c ../../src/xz-${v_xz}.tar.gz | $tar xf -
                (   cd xz-${v_xz}
                    $patch -p0 <../../../src/xz-${v_xz}.patch
                    CC="$cc" \
                    ./configure \
                        --without-libiconv-prefix \
                        --without-libintl-prefix \
                        --disable-assembler \
                        --disable-nls \
                        --disable-shared
                    ( cd src/liblzma && make ) 
                    ln -s src/liblzma/api/lzma .
                    ln -s src/liblzma/api/lzma.h .
                    ln -s src/liblzma/.libs/liblzma.a .
                ) || exit $?
            ) || exit $?
        fi

        #   OpenSSL (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/openssl-${v_openssl}" ]; then
            echo "++ building third-party library openssl-${v_openssl}"
            (   cd $base3rd/bin/$platform
                rm -rf openssl-${v_openssl}
                $gzip -d -c ../../src/openssl-${v_openssl}.tar.gz | $tar xf -
                (   cd openssl-${v_openssl}
                    $patch -p0 <../../../src/openssl-${v_openssl}.patch
                    $SHTOOL subst \
                        -e 's;-m486;-march=i486;g' \
                        -e 's;BN_LLONG *;;' \
                        Configure
                    $SHTOOL subst \
                        -e 's;test "$OSTYPE" = msdosdjgpp;true;' \
                        util/point.sh
                    $SHTOOL subst \
                        -e "1s;^.*\$;#!$PERL;" \
                        Configure `find . -name "*.pl" -print`
                    opts=""
                    case `$SHTOOL platform -n -L -S "" -C "+" -F "%<ap>-%<sp>"` in
                        *-solaris*      ) opts="-lnsl -lsocket" ;;
                    esac
                    case `$SHTOOL platform -n -L -S "" -C "+" -F "%<ap>-%<sp>"` in
                        amd64-*          ) opts="$opts -fPIC" ;;
                        ia64-*           ) opts="$opts -fPIC" ;;
                        sparc64-freebsd* ) opts="$opts -fPIC" ;;
                    esac
                    CC="$cc" \
                    ./config \
                        --prefix=%{l_prefix} \
                        no-asm no-shared no-dso \
                        no-zlib no-idea no-threads no-krb5 no-hw \
                        $opts
                    make build_libs build_apps
                    ( mkdir lib; cd lib; ln -s ../lib*.a . )
                ) || exit $?
            ) || exit $?
        fi

        #   Expat (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/expat-${v_expat}" ]; then
            echo "++ building third-party library expat-${v_expat}"
            (   cd $base3rd/bin/$platform
                rm -rf expat-${v_expat}
                $gzip -d -c ../../src/expat-${v_expat}.tar.gz | $tar xf -
                (   cd expat-${v_expat}
                    CC="$cc" \
                    ./configure \
                        --disable-shared
                    make libexpat.la
                ) || exit $?
            ) || exit $?
        fi

        #   Neon (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/neon-${v_neon}" ]; then
            echo "++ building third-party library neon-${v_neon}"
            (   cd $base3rd/bin/$platform
                rm -rf neon-${v_neon}
                $gzip -d -c ../../src/neon-${v_neon}.tar.gz | $tar xf -
                (   cd neon-${v_neon}
                    ( echo "ac_cv_path_KRB5_CONFIG="
                    ) >config.cache
                    CC="$cc" \
                    CPPFLAGS="-I`pwd`/../openssl-${v_openssl}/include -I`pwd`/../zlib-${v_zlib} -I`pwd`/../expat-${v_expat}/lib" \
                    LDFLAGS="-L`pwd`/../openssl-${v_openssl}/lib -L`pwd`/../zlib-${v_zlib} -L`pwd`/../expat-${v_expat}/lib -L`pwd`/../expat-${v_expat}/.libs" \
                    ./configure \
                        --cache-file=./config.cache \
                        --with-libs=/tmp \
                        --with-ssl=openssl \
                        --without-libxml2 \
                        --with-expat \
                        --enable-webdav \
                        --disable-nls \
                        --disable-shared \
                        --enable-static
                    make
                    ( cd src; ln -s . neon )
                ) || exit $?
            ) || exit $?
        fi

        #   BeeCrypt (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/beecrypt-${v_beecrypt}" ]; then
            echo "++ building third-party library beecrypt-${v_beecrypt}"
            (   cd $base3rd/bin/$platform
                rm -rf beecrypt-${v_beecrypt}
                $gzip -d -c ../../src/beecrypt-${v_beecrypt}.tar.gz | $tar xf -
                (   cd beecrypt-${v_beecrypt}
                    $patch -p0 <../../../src/beecrypt-${v_beecrypt}.patch
                    cp ../../../src/config.guess-${v_config} config.guess
                    cp ../../../src/config.sub-${v_config} config.sub
                    $SHTOOL subst \
                        -e 's;^[ 	][ 	]*#;#;' \
                        aes.c base64.c blowfish.c entropy.c fips186.c fips186.h md5.c \
                        md5.h mp.c mtprng.c mtprng.h sha1.c sha1.h sha256.c sha256.h timestamp.c
                    $SHTOOL subst \
                       -e 's;cppglue\.lo;;g' \
                       -e 's;cppglue\.cxx;;g' \
                       -e '/^CXX = /s;@CXX@;@CC@;g' \
                       Makefile.in
                    $SHTOOL subst \
                        -e '/LINENO: error: C[+]* preprocessor/{N;N;N;N;s/.*/  \}/;}' \
                        configure
                    ( echo 'ac_cv_have_dev_dsp=no'
                      echo 'ac_cv_have_dev_audio=no'
                      echo 'ac_cv_func_gettimeofday=yes'
                      echo 'bc_cv_as_noexecstack=no'
                    ) >config.cache
                    CC="$cc" \
                    CFLAGS="-O" \
                    ./configure \
                        --cache-file=./config.cache \
                        --without-cplusplus \
                        --without-java \
                        --without-python \
                        --disable-threads \
                        --disable-openmp \
                        --disable-shared
                    make
                ) || exit $?
            ) || exit $?
        fi

        #   Berkeley-DB (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/db-${v_db}" ]; then
            echo "++ building third-party library db-${v_db}"
            (   cd $base3rd/bin/$platform
                rm -rf db-${v_db}
                $gzip -d -c ../../src/db-${v_db}.tar.gz | $tar xf -
                (   cd db-${v_db}
                    $patch -p0 <../../../src/db-${v_db}.patch
                    mutex="UNIX/fcntl"
                    if [ ".`($cc -v; $cc --version) </dev/null 2>&1 | grep -i 'gcc'`" != . ]; then
                        case "$platform" in
                            ix86-*   ) mutex="x86/gcc-assembly"   ;;
                            ia64-*   ) mutex="ia64/gcc-assembly"  ;;
                            sparc*-* ) mutex="Sparc/gcc-assembly" ;;
                            ppc*-*   ) mutex="PPC/gcc-assembly"   ;;
                            alpha*-* ) mutex="ALPHA/gcc-assembly" ;;
                        esac
                    fi
                    cd build_unix
                    CC="$cc" \
                    ../dist/configure \
                        --disable-compat185 \
                        --disable-cxx \
                        --disable-java \
                        --with-mutex="$mutex" \
                        --disable-shared
                    make
                ) || exit $?
            ) || exit $?
        fi

        #   SQLite (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/sqlite-${v_sqlite}" ]; then
            echo "++ building third-party library sqlite-${v_sqlite}"
            (   cd $base3rd/bin/$platform
                rm -rf sqlite-${v_sqlite}
                $gzip -d -c ../../src/sqlite-${v_sqlite}.tar.gz | $tar xf -
                (   cd sqlite-${v_sqlite}
                    $patch -p0 <../../../src/sqlite-${v_sqlite}.patch
                    CC="$cc" \
                    LIBS="-lm" \
                    ./configure \
                        --disable-utf8 \
                        --disable-readline \
                        --disable-threadsafe \
                        --disable-debug \
                        --disable-amalgamation \
                        --disable-shared
                    make
                ) || exit $?
            ) || exit $?
        fi

        #   Lua (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/lua-${v_lua}" ]; then
            echo "++ building third-party library lua-${v_lua}"
            (   cd $base3rd/bin/$platform
                rm -rf lua-${v_lua}
                $gzip -d -c ../../src/lua-${v_lua}.tar.gz | $tar xf -
                (   cd lua-${v_lua}
                    $patch -p0 <../../../src/lua-${v_lua}.patch
                    platform="posix"
                    case "$platform" in
                        *-linux*   ) platform="linux"   ;;
                        *-freebsd* ) platform="bsd"     ;;
                        *-sunos*   ) platform="solaris" ;;
                    esac
                    make CC="$cc" CFLAGS="-O \$(MYCFLAGS)" $platform
                ) || exit $?
            ) || exit $?
        fi

        #   File (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/file-${v_file}" ]; then
            echo "++ building third-party library file-${v_file}"
            (   cd $base3rd/bin/$platform
                rm -rf file-${v_file}
                $gzip -d -c ../../src/file-${v_file}.tar.gz | $tar xf -
                (   cd file-${v_file}
                    $patch -p0 <../../../src/file-${v_file}.patch
                    ( echo "ac_cv_lib_z_gzopen=no"
                    ) >config.cache
                    CC="$cc" \
                    ./configure \
                        --cache-file=./config.cache \
                        --disable-shared \
                        --disable-nls
                    make
                ) || exit $?
            ) || exit $?
        fi

        #   POPT (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/popt-${v_popt}" ]; then
            echo "++ building third-party library popt-${v_popt}"
            (   cd $base3rd/bin/$platform
                rm -rf popt-${v_popt}
                $gzip -d -c ../../src/popt-${v_popt}.tar.gz | $tar xf -
                (   cd popt-${v_popt}
                    $patch -p0 <../../../src/popt-${v_popt}.patch
                    CC="$cc" \
                    CPPFLAGS="-DOPENPKG -DPOPT_fprintf=fprintf" \
                    GREP="grep" \
                    ./configure \
                        --disable-shared \
                        --with-included-gettext \
                        --without-libintl-prefix \
                        --without-libiconv-prefix \
                        --disable-nls
                    make
                ) || exit $?
            ) || exit $?
        fi

        #   LibXML2 (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/libxml2-${v_libxml2}" ]; then
            echo "++ building third-party library libxml2-${v_libxml2}"
            (   cd $base3rd/bin/$platform
                rm -rf libxml2-${v_libxml2}
                $gzip -d -c ../../src/libxml2-${v_libxml2}.tar.gz | $tar xf -
                (   cd libxml2-${v_libxml2}
                    $patch -p0 <../../../src/libxml2-${v_libxml2}.patch
                    $SHTOOL subst \
                        -e '/LINENO: error: C[+]* preprocessor/{N;N;N;N;s/.*/:/;}' \
                        configure
                    CC="$cc" \
                    CPPFLAGS="-I`pwd`/../zlib-${v_zlib}" \
                    LDFLAGS="-L`pwd`/../zlib-${v_zlib}" \
                    ./configure \
                        --without-iconv \
                        --disable-shared \
                        --disable-corba \
                        --without-threads \
                        --without-python
                    make
                ) || exit $?
            ) || exit $?
        fi

        #   XAR (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/xar-${v_xar}" ]; then
            echo "++ building third-party library xar-${v_xar}"
            (   cd $base3rd/bin/$platform
                rm -rf xar-${v_xar}
                $gzip -d -c ../../src/xar-${v_xar}.tar.gz | $tar xf -
                (   cd xar-${v_xar}
                    $patch -p0 <../../../src/xar-${v_xar}.patch
                    if [ "`uname`" = "Darwin" ]; then STATICFLAGS="-Wl,-search_paths_first"; fi
                    CC="$cc" \
                    CPPFLAGS="-I`pwd`/../openssl-${v_openssl}/include -I`pwd`/../zlib-${v_zlib} -I`pwd`/../libxml2-${v_libxml2}/include" \
                    LDFLAGS="-L`pwd`/../openssl-${v_openssl}/lib -L`pwd`/../zlib-${v_zlib} -L`pwd`/../libxml2-${v_libxml2} -L`pwd`/../libxml2-${v_libxml2}/.libs $STATICFLAGS" \
                    ./configure \
                        --with-xml2-config="`pwd`/../libxml2-${v_libxml2}/xml2-config" \
                        --disable-autogen \
                        --disable-shared
                    make
                ) || exit $?
            ) || exit $?
        fi

        #   PCRE (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/pcre-${v_pcre}" ]; then
            echo "++ building third-party library pcre-${v_pcre}"
            (   cd $base3rd/bin/$platform
                rm -rf pcre-${v_pcre}
                $gzip -d -c ../../src/pcre-${v_pcre}.tar.gz | $tar xf -
                (   cd pcre-${v_pcre}
                    $patch -p0 <../../../src/pcre-${v_pcre}.patch
                    CC="$cc" \
                    GREP="grep" \
                    ./configure \
                        --disable-cpp \
                        --disable-utf8 \
                        --disable-shared
                    make
                ) || exit $?
            ) || exit $?
        fi

        #   OSSP uuid (uninstalled third-party library)
        if [ ! -d "$base3rd/bin/$platform/uuid-${v_uuid}" ]; then
            echo "++ building third-party library uuid-${v_uuid}"
            (   cd $base3rd/bin/$platform
                rm -rf uuid-${v_uuid}
                $gzip -d -c ../../src/uuid-${v_uuid}.tar.gz | $tar xf -
                (   cd uuid-${v_uuid}
                    $SHTOOL subst \
                        -e '/LINENO: error: C[+]* preprocessor/{N;N;N;N;s/.*/:/;}' \
                        configure
                    CC="$cc" \
                    GREP="grep" \
                    ./configure \
                        --disable-shared
                    make
                ) || exit $?
            ) || exit $?
        fi
    }

    #   configure build environment
    standalone_autogen () {
        echo "++ generating build environment"
        %autogen
    }

    #   configure build environment
    standalone_configure () {
        echo "++ cleaning up build environment"
        ( cd ${DEVTOOL_SRCDIR}; make distclean || true ) >/dev/null 2>&1

        echo "++ configuring build environment"
        base3rd="`cd $base3rd && pwd`"
        CFLAGS=""
        CPPFLAGS=""
        LDFLAGS=""
        LIBS=""
        GREP="grep"
        if [ ".$RPM_VENDOR_OPENPKG" != . ]; then
            CPPFLAGS="$CPPFLAGS -DRPM_VENDOR_OPENPKG"
            RPM_INTEGRITY_FP=`cat scripts/integrity.fp`
            RPM_INTEGRITY_MV=`grep 'integrity\.version' scripts/integrity.lua |\
                sed -e 's;^.*"\([0-9][0-9.]*\)".*$;\1;'`
            CPPFLAGS="$CPPFLAGS -DRPM_INTEGRITY_FP=\\\"$RPM_INTEGRITY_FP\\\""
            CPPFLAGS="$CPPFLAGS -DRPM_INTEGRITY_MV=\\\"$RPM_INTEGRITY_MV\\\""
        fi
        LDFLAGS="$LDFLAGS -L$base3rd/bin/$platform/openssl-${v_openssl}"       # shameless workaround for Neon/XAR
        LDFLAGS="$LDFLAGS -L$base3rd/bin/$platform/libxml2-${v_libxml2}/.libs" # shameless workaround for XAR
        LDFLAGS="$LDFLAGS -L$base3rd/bin/$platform/zlib-${v_zlib}"             # shameless workaround for XAR
        LIBS="$LIBS -lssl -lcrypto"                                            # shameless workaround for Neon/XAR
        LIBS="$LIBS -lxml2 -lz"                                                # shameless workaround for XAR
        LIBS="$LIBS -lm"                                                       # shameless workaround for SQLite
        export CFLAGS
        export CPPFLAGS
        export LDFLAGS
        export LIBS
        export GREP
        OPTION=""
        OPTION="$OPTION --prefix=\"$prefix\""
        OPTION="$OPTION --mandir=\"$prefix/man\""
        OPTION="$OPTION --with-path-cfg=\"$prefix/etc/rpm\""
        OPTION="$OPTION --with-path-rpmpopt=\"$prefix/lib/rpm/rpmpopt:$prefix/etc/rpm/rpmpopt:~/.rpmpopt\""
        OPTION="$OPTION --with-path-macros=\"$prefix/lib/rpm/macros:$prefix/etc/rpm/macros:~/.rpmmacros\""
        OPTION="$OPTION --with-path-rpmlua=\"$prefix/lib/rpm/rpmlua:$prefix/etc/rpm/rpmlua:~/.rpmlua\""
        OPTION="$OPTION --with-path-lib=\"$prefix/lib/rpm\""
        OPTION="$OPTION --with-path-locale=\"$prefix/share/rpm/locale\""
        OPTION="$OPTION --with-path-database=\"$prefix/var/rpm/db\""
        OPTION="$OPTION --with-path-sources=\"$prefix/var/rpm/src\""
        OPTION="$OPTION --with-bugreport=\"openpkg-users@openpkg.org\""
        OPTION="$OPTION --with-beecrypt=\"$base3rd/bin/$platform/beecrypt-${v_beecrypt}\""
        OPTION="$OPTION --with-openssl=\"$base3rd/bin/$platform/openssl-${v_openssl}\""
        if [ ".$RPM_VENDOR_OPENPKG" != . ]; then
            OPTION="$OPTION --with-lua=\"internal\""
        else
            OPTION="$OPTION --with-lua=\"$base3rd/bin/$platform/lua-${v_lua}/src\""
        fi
        OPTION="$OPTION --with-pcre=\"$base3rd/bin/$platform/pcre-${v_pcre}\""
        OPTION="$OPTION --with-uuid=\"$base3rd/bin/$platform/uuid-${v_uuid}\""
        OPTION="$OPTION --with-file=\"$base3rd/bin/$platform/file-${v_file}\""
        OPTION="$OPTION --with-zlib=\"$base3rd/bin/$platform/zlib-${v_zlib}\""
        OPTION="$OPTION --with-bzip2=\"$base3rd/bin/$platform/bzip2-${v_bzip2}\""
        OPTION="$OPTION --with-neon=\"$base3rd/bin/$platform/neon-${v_neon}\""
        OPTION="$OPTION --with-popt=\"$base3rd/bin/$platform/popt-${v_popt}\""
        OPTION="$OPTION --with-xar=\"$base3rd/bin/$platform/xar-${v_xar}\""
        OPTION="$OPTION --with-sqlite=\"$base3rd/bin/$platform/sqlite-${v_sqlite}\""
        OPTION="$OPTION --with-db=\"$base3rd/bin/$platform/db-${v_db}/build_unix\""
        OPTION="$OPTION --with-xz=\"$base3rd/bin/$platform/xz-${v_xz}\""
        OPTION="$OPTION --without-db-rpc"
        OPTION="$OPTION --without-db-sql-codegen"
        OPTION="$OPTION --without-db-largefile"
        OPTION="$OPTION --with-db-tools-integrated"
        OPTION="$OPTION --with-db-mutex=\"UNIX/fcntl\""
        OPTION="$OPTION --without-pthreads"
        OPTION="$OPTION --without-libelf"
        OPTION="$OPTION --without-selinux"
        OPTION="$OPTION --without-perl"
        OPTION="$OPTION --without-python"
        OPTION="$OPTION --without-apidocs"
        OPTION="$OPTION --disable-build-intlibdep"
        OPTION="$OPTION --disable-build-extlibdep"
        OPTION="$OPTION --disable-build-lafiles"
        OPTION="$OPTION --enable-build-warnings"
        OPTION="$OPTION --enable-build-debug"
        OPTION="$OPTION --disable-openmp"
        OPTION="$OPTION --disable-shared"
        OPTION="$OPTION --disable-rpath"
        OPTION="$OPTION --disable-nls"
        eval "${DEVTOOL_SRCDIR}/configure -v $OPTION"
    }

    #   build RPM
    standalone_build () {
        make
    }

    #   install RPM
    standalone_install () {
        rm -rf $prefix
        make install
        # install required runtime files for uninstalled third-party library "file" (libmagic)
        install -d -m 755 $prefix/share/file
        if [ -f $base3rd/bin/$platform/file-${v_file}/magic/magic ]; then
        install -m 644 $base3rd/bin/$platform/file-${v_file}/magic/magic $prefix/share/file/
        fi
        install -m 644 $base3rd/bin/$platform/file-${v_file}/magic/magic.mgc $prefix/share/file/
    }

    #   test RPM (trivially only)
    standalone_testdrive () {
        (   set -x
            $prefix/bin/rpm -vv --import ${DEVTOOL_SRCDIR}/pubkeys/JBJ-GPG-KEY || exit $?
            $prefix/bin/rpm -vv -qa || exit $?
            $prefix/bin/rpm -vv -qi gpg-pubkey-2039b291-3dbaae72 || exit $?
            $prefix/bin/rpm -vv -e gpg-pubkey-2039b291-3dbaae72 || exit $?
            $prefix/bin/rpm -vv -Va || exit $?
            macros="macros/macros" # override --macros to avoid ~/.rpmmacros
            rpmtopdir="`$prefix/bin/rpm --macros=$macros --eval %{_topdir}`"
            $prefix/bin/rpmbuild -vv --macros=$macros -ba ${DEVTOOL_SRCDIR}/devtool-test.spec || exit $?
            $prefix/bin/rpmbuild -vv --macros=$macros --rebuild $rpmtopdir/SRPMS/devtool-test-1.0-1.src.rpm || exit $?
            $prefix/bin/rpm -vv -qpil $rpmtopdir/RPMS/noarch/devtool-test-1.0-1.noarch.rpm || exit $?
            rm -f $rpmtopdir/SRPMS/devtool-test-1.0-1.src.rpm
            $prefix/bin/rpm -vv -iv $rpmtopdir/RPMS/noarch/devtool-test-1.0-1.noarch.rpm || exit $?
            $prefix/bin/rpm -vv -qi devtool-test-1.0-1 || exit $?
            $prefix/bin/rpm -vv -e devtool-test-1.0-1 || exit $?
            rm -f $rpmtopdir/RPMS/noarch/devtool-test-1.0-1.noarch.rpm
        ) >/tmp/rpm.devtool.standalone.testdrive 2>&1
        if [ $? -ne 0 ]; then
            echo "devtool:standalone:testdrive:ERROR: trivial testsuite failed (trace follows):"
            cat /tmp/rpm.devtool.standalone.testdrive
        fi
        rm -f /tmp/rpm.devtool.standalone.testdrive
    }

    #   do all at once
    standalone_all () {
        standalone_prepare
        standalone_autogen
        standalone_configure
        standalone_build
        standalone_install
        standalone_testdrive
    }

%macosx
    %checkout
    %macports
    gnumake install DESTDIR=/tmp/rpm-root
    DYLD_LIBRARY_PATH=/tmp/rpm-root/opt/local/lib:/tmp/rpm-root/opt/local/lib/rpm/lib:$DYLD_LIBRARY_PATH /tmp/rpm-root/opt/local/bin/rpm --version

%macports
	# Ports:
	#       automake
	#       autoconf
	#       libiconv
	#       gettext
	#       db51
	#       sqlite3
	#       popt
	#       beecrypt
	#       expat
	#       neon
	#       zlib
	#       file
	#       xar-devel
	#       liblzma
	#       pcre
	#       ossp-uuid
	#  *    lua
	#       python26
	#       perl5.10

	prefix="/opt/local"
	PATH=${prefix}/bin:$PATH
	%autogen
	CPPFLAGS="-I${prefix}/include -I${prefix}/include/xar \
	          -I${prefix}/include/ossp -I${prefix}/include/db51"
	LDFLAGS="-L${prefix}/lib -L${prefix}/lib/db51"
	export CPPFLAGS
	export LDFLAGS
	__PYTHON=${prefix}/bin/python2.6
	__PERL=${prefix}/bin/perl5.10
	export __PYTHON
	export __PERL
	%configure \
		--prefix=${prefix} \
		--with-libintl-prefix=${prefix} \
		--with-libiconv-prefix=${prefix} \
		--mandir=${prefix}/share/man \
		--infodir=${prefix}/share/info \
		--with-lua=internal \
		--without-js \
		--with-python=`$__PYTHON -c "import sys; print sys.version[:3]"` \
		--with-perl \
		--with-db \
		--with-sqlite \
		--with-popt=external \
		--with-beecrypt=external \
		--with-neon=external \
		--with-xar=external \
		--with-xz=external \
		--with-pcre=external \
		--with-uuid=external \
		--without-apidocs \
		--sysconfdir=${prefix}/etc \
		--with-path-cfg=${prefix}/etc/rpm \
		--enable-broken-chown \
		--disable-rpath

%freebsd
    %checkout
    %ports
    pkg_add -r gmake bash
    gmake SHELL=`which bash`

%ports
	# Ports: (* = internal)
	#       devel/automake111
	#       devel/autoconf268
	#       devel/doxygen
	#       graphics/graphviz
	#       converters/libiconv
	#       devel/gettext
	#  *    lang/lua
	#  *    textproc/syck
	#       lang/perl5.10
	#       lang/python26
	#       databases/db51          SQL=on
	#       databases/sqlite3       EXTENSION=on
	#       devel/popt              >= 1.15
	#       security/beecrypt       >= 4.2.1
	#       www/neon29
	#       sysutils/file
	#       archivers/xar
	#       archivers/xz
	#       devel/pcre
	#       misc/ossp-uuid

	%autogen
	LOCALBASE=/usr/local
	PREFIX=${LOCALBASE}
	sed -i -E -e "s:\$(libdir)/pkgconfig:${PREFIX}/libdata/pkgconfig:" \
		scripts/Makefile.in
	CPPFLAGS="-I${LOCALBASE}/include -I${LOCALBASE}/include/xar \
	          -I${LOCALBASE}/include/db51"
	LDFLAGS="-L${LOCALBASE}/lib -L${LOCALBASE}/lib/db51"
	export CPPFLAGS
	export LDFLAGS
	%configure \
		--with-lua=internal \
		--with-syck=internal \
		--without-js \
		--without-gpsee \
		--with-perl \
		--with-python \
		--with-apidocs \
		--with-db \
		--with-sqlite \
		--with-dbsql \
		--with-db-tools-integrated \
		--with-popt=external \
		--with-beecrypt=external \
		--with-neon=external \
		--with-zlib=external \
		--with-file=external \
		--with-xar=external \
		--with-xz=external \
		--with-pcre=external \
		--with-uuid=external \
		--sysconfdir=${PREFIX}/etc \
		--with-path-cfg=${PREFIX}/etc/rpm \
		--prefix=${PREFIX} \
		--mandir=${PREFIX}/man \
		--infodir=${PREFIX}/info \
		--disable-openmp

%prepare
    %checkout
	%autogen
	%configure

%tarball
    %prepare
    make dist

%tarball.xz
    %prepare
	make dist-xz

