srcdir = @srcdir@
VPATH = $(srcdir)

LIBOBJECTS = \
misc.o              parsePreamble.o     part.o \
package.o           parseDescription.o  parsePrep.o         read.o \
parseFiles.o        parseReqs.o         reqprov.o \
parseChangelog.o    parseSpec.o         spec.o \
parseScript.o       parseBuildInstallClean.o  build.o \
files.o myftw.o names.o pack.o macro.o

LIBBUILD = librpmbuild.a
LOADLIBES = -lrpm -lz ../popt/libpopt.a $(LIBEFENCE)

# -----------------------------------------------------------------------

include $(srcdir)/../Makefile.inc

ifeq (.depend,$(wildcard .depend))
TARGET=everything
else
TARGET=depend everything
endif

all: $(TARGET)

everything: $(LIBBUILD)

$(LIBBUILD): $(LIBOBJECTS) 
	$(AR) r $@ $(LIBOBJECTS)
	$(RANLIB) $@

$(PROGS): $(LIBOBJECTS)

pack.o:
	$(CC) $(CFLAGS) -DVERSION=\"$(VERSION)\" -o $@ -c $<

clean:
	rm -f *.a *.o *~ $(PROGS)

distclean: clean
	rm -f .depend Makefile

depend:
	$(CPP) $(CFLAGS) -M $(srcdir)/*.c > .depend

ifeq (.depend,$(wildcard .depend))
include .depend
endif
