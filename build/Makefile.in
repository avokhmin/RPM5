srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@

LIBOBJECTS = \
	build.o files.o macro.o misc.o myftw.o names.o pack.o \
	parseBuildInstallClean.o parseChangelog.o parseDescription.o \
	parseFiles.o parsePreamble.o parsePrep.o parseReqs.o \
	parseScript.o parseSpec.o reqprov.o spec.o

LIBBUILD = librpmbuild.a
LOADLIBES = -lrpm -lz ../popt/libpopt.a $(LIBEFENCE)
PROGS =
INSTALL= @INSTALL@
INSTALL_PROGRAM= @INSTALL_PROGRAM@
INSTALL_DATA= @INSTALL_DATA@

# -----------------------------------------------------------------------

include ../Makefile.inc

TARGET=everything

all: $(TARGET)

everything: $(LIBBUILD)

$(LIBBUILD): $(LIBOBJECTS) 
	$(AR) r $@ $(LIBOBJECTS)
	$(RANLIB) $@

$(PROGS): $(LIBOBJECTS)

# GNU make doesn't need the pack.c on here, but broken makes may
pack.o: pack.c
	$(CC) $(CFLAGS) -DVERSION=\"$(VERSION)\" -o $@ -c $<

files.o: files.c
	$(CC) $(CFLAGS) -DFINDPROVIDES=\"$(FINDPROVIDES)\" -DFINDREQUIRES=\"$(FINDREQUIRES)\" -o $@ -c $<

spec.o: spec.c
	$(CC) $(CFLAGS) -DMACROFILE=\"$(MACROFILE)\" -o $@ -c $<

install:
	$(INSTALL_DATA) -m 644 $(srcdir)/rpmbuild.h $(INCDIR)
	$(INSTALL_DATA) -m 644 $(srcdir)/rpmmacro.h $(INCDIR)
	$(INSTALL_DATA) -m 644 $(srcdir)/rpmspec.h $(INCDIR)
	$(INSTALL_DATA) -m 644 librpmbuild.a $(LIBDIR)

distclean: clean
	rm -f Makefile

clean:
	rm -f *.a *.o *~ $(PROGS)

depend:
	topdir_path=`( cd $(top_srcdir) && pwd )` ; \
	$(CPP) $(CFLAGS) -MM $(srcdir)/*.c | \
	    sed s+$$topdir_path+$(top_srcdir)+g > .depend

ifeq (.depend,$(wildcard .depend))
include .depend
endif
